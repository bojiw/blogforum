(function(A){var C={};function B(E){if(C[E]){return C[E].exports}var D=C[E]={i:E,l:false,exports:{}};A[E].call(D.exports,D,D.exports,B);D.l=true;return D.exports}B.m=A;B.c=C;B.d=function(F,D,E){if(!B.o(F,D)){Object.defineProperty(F,D,{configurable:false,enumerable:true,get:E})}};B.n=function(D){var E=D&&D.__esModule?function F(){return D["default"]}:function G(){return D};B.d(E,"a",E);return E};B.o=function(D,E){return Object.prototype.hasOwnProperty.call(D,E)};B.p="";return B(B.s=2)})([(function(C,F,B){var A,E,G;var D=true;(function(H,J){var I=function(){var K={};J.apply(K,arguments);return K.moxie};if(true){!(E=[],A=(I),G=(typeof A==="function"?(A.apply(F,E)):A),G!==undefined&&(C.exports=G))}else{if(typeof C==="object"&&C.exports){C.exports=I()}else{H.moxie=I()}}}(this||window,function(){(function(O,H){var L={};function J(T,P){var S,R=[];for(var Q=0;Q<T.length;++Q){S=L[T[Q]]||M(T[Q]);if(!S){throw"module definition dependecy not found: "+T[Q]}R.push(S)}P.apply(null,R)}function I(R,P,Q){if(typeof R!=="string"){throw"invalid module definition, module id must be defined and be a string"}if(P===H){throw"invalid module definition, dependencies must be specified"}if(Q===H){throw"invalid module definition, definition function must be specified"}J(P,function(){L[R]=Q.apply(null,arguments)})}function N(P){return !!L[P]}function M(S){var R=O;var P=S.split(/[.\/]/);for(var Q=0;Q<P.length;++Q){if(!R[P[Q]]){return}R=R[P[Q]]}return R}function K(S){for(var Q=0;Q<S.length;Q++){var T=O;var U=S[Q];var P=U.split(/[.\/]/);for(var R=0;R<P.length-1;++R){if(T[P[R]]===H){T[P[R]]={}}T=T[P[R]]}T[P[P.length-1]]=L[U]}}I("moxie/core/utils/Basic",[],function(){function Z(k){var l;if(k===l){return"undefined"}else{if(k===null){return"null"}else{if(k.nodeType){return"node"}}}return({}).toString.call(k).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}function W(){return a(false,false,arguments)}function T(){return a(true,false,arguments)}function j(){return a(false,true,arguments)}function R(){return a(true,true,arguments)}function b(k){switch(Z(k)){case"array":return Array.prototype.slice.call(k);case"object":return W({},k)}return k}function a(l,k,o){var m;var n=o[0];U(o,function(q,p){if(p>0){U(q,function(t,r){var s=X(Z(t),["array","object"])!==-1;if(t===m||l&&n[r]===m){return true}if(s&&k){t=b(t)}if(Z(n[r])===Z(t)&&s){a(l,k,[n[r],t])}else{n[r]=t}})}});return n}function Q(l,m){for(var k in m){if({}.hasOwnProperty.call(m,k)){l[k]=m[k]}}function n(){this.constructor=l}n.prototype=m.prototype;l.prototype=new n();l.__parent__=m.prototype;return l}function U(m,k){var l,q,n,p;if(m){try{l=m.length}catch(o){l=p}if(l===p||typeof(l)!=="number"){for(q in m){if(m.hasOwnProperty(q)){if(k(m[q],q)===false){return}}}}else{for(n=0;n<l;n++){if(k(m[n],n)===false){return}}}}}function P(k){var l;if(!k||Z(k)!=="object"){return true}for(l in k){return false}return true}function e(o,k){var l=0,m=o.length;if(Z(k)!=="function"){k=function(){}}if(!o||!o.length){k()}function n(p){if(Z(o[p])==="function"){o[p](function(q){++p<m&&!q?n(p):k(q)})}}n(l)}function c(o,k){var l=0,n=o.length,m=new Array(n);U(o,function(q,p){q(function(r){if(r){return k(r)}var s=[].slice.call(arguments);s.shift();m[p]=s;l++;if(l===n){m.unshift(null);k.apply(this,m)}})})}function X(k,l){if(l){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(l,k)}for(var m=0,n=l.length;m<n;m++){if(l[m]===k){return m}}}return -1}function h(n,k){var m=[];if(Z(n)!=="array"){n=[n]}if(Z(k)!=="array"){k=[k]}for(var l in n){if(X(n[l],k)===-1){m.push(n[l])}}return m.length?m:false}function g(k,m){var l=[];U(k,function(n){if(X(n,m)!==-1){l.push(n)}});return l.length?l:null}function i(l){var k,m=[];for(k=0;k<l.length;k++){m[k]=l[k]}return m}var S=(function(){var k=0;return function(n){var l=new Date().getTime().toString(32),m;for(m=0;m<5;m++){l+=Math.floor(Math.random()*65535).toString(32)}return(n||"o_")+l+(k++).toString(32)}}());function f(k){if(!k){return k}return String.prototype.trim?String.prototype.trim.call(k):k.toString().replace(/^\s*/,"").replace(/\s*$/,"")}function Y(k){if(typeof(k)!=="string"){return k}var m={t:1099511627776,g:1073741824,m:1048576,k:1024},l;k=/^([0-9\.]+)([tmgk]?)$/.exec(k.toLowerCase().replace(/[^0-9\.tmkg]/g,""));l=k[2];k=+k[1];if(m.hasOwnProperty(l)){k*=m[l]}return Math.floor(k)}function d(k){var l=[].slice.call(arguments,1);return k.replace(/%[a-z]/g,function(){var m=l.shift();return Z(m)!=="undefined"?m:""})}function V(k,m){var l=this;setTimeout(function(){k.call(l)},m||1)}return{guid:S,typeOf:Z,extend:W,extendIf:T,extendImmutable:j,extendImmutableIf:R,inherit:Q,each:U,isEmptyObj:P,inSeries:e,inParallel:c,inArray:X,arrayDiff:h,arrayIntersect:g,toArray:i,trim:f,sprintf:d,parseSizeStr:Y,delay:V}});I("moxie/core/utils/Encode",[],function(){var P=function(T){return unescape(encodeURIComponent(T))};var S=function(T){return decodeURIComponent(escape(T))};var Q=function(X,c){if(typeof(window.atob)==="function"){return c?S(window.atob(X)):window.atob(X)}var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var T,V,Y,f,W,g,e,U,d=0,h=0,Z="",a=[];if(!X){return X}X+="";do{f=b.indexOf(X.charAt(d++));W=b.indexOf(X.charAt(d++));g=b.indexOf(X.charAt(d++));e=b.indexOf(X.charAt(d++));U=f<<18|W<<12|g<<6|e;T=U>>16&255;V=U>>8&255;Y=U&255;if(g==64){a[h++]=String.fromCharCode(T)}else{if(e==64){a[h++]=String.fromCharCode(T,V)}else{a[h++]=String.fromCharCode(T,V,Y)}}}while(d<X.length);Z=a.join("");return c?S(Z):Z};var R=function(X,d){if(d){X=P(X)}if(typeof(window.btoa)==="function"){return window.btoa(X)}var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var T,V,a,g,W,h,f,U,e=0,j=0,Z="",b=[];if(!X){return X}do{T=X.charCodeAt(e++);V=X.charCodeAt(e++);a=X.charCodeAt(e++);U=T<<16|V<<8|a;g=U>>18&63;W=U>>12&63;h=U>>6&63;f=U&63;b[j++]=c.charAt(g)+c.charAt(W)+c.charAt(h)+c.charAt(f)}while(e<X.length);Z=b.join("");var Y=X.length%3;return(Y?Z.slice(0,Y-3):Z)+"===".slice(Y||3)};return{utf8_encode:P,utf8_decode:S,atob:Q,btoa:R}});I("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(U){var S=(function(l){var e="",p="?",m="function",n="undefined",f="object",i="major",c="model",o="name",d="type",W="vendor",j="version",Y="architecture",X="console",b="mobile",k="tablet";var h={has:function(r,q){return q.toLowerCase().indexOf(r.toLowerCase())!==-1},lowerize:function(q){return q.toLowerCase()}};var V={rgx:function(){for(var u,x=0,v,w,r,s,y,t,Ab=arguments;x<Ab.length;x+=2){var z=Ab[x],Aa=Ab[x+1];if(typeof(u)===n){u={};for(r in Aa){s=Aa[r];if(typeof(s)===f){u[s[0]]=l}else{u[s]=l}}}for(v=w=0;v<z.length;v++){y=z[v].exec(this.getUA());if(!!y){for(r=0;r<Aa.length;r++){t=y[++w];s=Aa[r];if(typeof(s)===f&&s.length>0){if(s.length==2){if(typeof(s[1])==m){u[s[0]]=s[1].call(this,t)}else{u[s[0]]=s[1]}}else{if(s.length==3){if(typeof(s[1])===m&&!(s[1].exec&&s[1].test)){u[s[0]]=t?s[1].call(this,t,s[2]):l}else{u[s[0]]=t?t.replace(s[1],s[2]):l}}else{if(s.length==4){u[s[0]]=t?s[3].call(this,t.replace(s[1],s[2])):l}}}}else{u[s]=t?t:l}}break}}if(!!y){break}}return u},str:function(s,r){for(var q in r){if(typeof(r[q])===f&&r[q].length>0){for(var t=0;t<r[q].length;t++){if(h.has(r[q][t],s)){return(q===p)?l:q}}}else{if(h.has(r[q],s)){return(q===p)?l:q}}}return s}};var Z={browser:{oldsafari:{major:{"1":["/8","/1","/3"],"2":"/4","?":"/"},version:{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{"HTC":"APA","Sprint":"Sprint"}}},os:{windows:{version:{"ME":"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0","2000":"NT 5.0","XP":["NT 5.1","NT 5.2"],"Vista":"NT 6.0","7":"NT 6.1","8":"NT 6.2","8.1":"NT 6.3","RT":"ARM"}}}};var g={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[o,j],[/\s(opr)\/([\w\.]+)/i],[[o,"Opera"],j],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],[o,j],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[o,"IE"],j],[/(edge)\/((\d+)?[\w\.]+)/i],[o,j],[/(yabrowser)\/([\w\.]+)/i],[[o,"Yandex"],j],[/(comodo_dragon)\/([\w\.]+)/i],[[o,/_/g," "],j],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[o,j],[/(dolfin)\/([\w\.]+)/i],[[o,"Dolphin"],j],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[o,"Chrome"],j],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[j,[o,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[j,[o,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[j,[o,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[j,[o,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[j,o],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[o,[j,V.str,Z.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[o,j],[/(navigator|netscape)\/([\w\.-]+)/i],[[o,"Netscape"],j],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[o,j]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[j,[o,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[o,j],[/rv\:([\w\.]+).*(gecko)/i],[j,o]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[o,j],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[o,[j,V.str,Z.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[o,"Windows"],[j,V.str,Z.os.windows.version]],[/\((bb)(10);/i],[[o,"BlackBerry"],j],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[o,j],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[o,"Symbian"],j],[/\((series40);/i],[o],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[o,"Firefox OS"],j],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[o,j],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[o,"Chromium OS"],j],[/(sunos)\s?([\w\.]+\d)*/i],[[o,"Solaris"],j],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[o,j],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[o,"iOS"],[j,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[o,"Mac OS"],[j,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[o,j]]};var a=function(r){var q=r||((window&&window.navigator&&window.navigator.userAgent)?window.navigator.userAgent:e);this.getBrowser=function(){return V.rgx.apply(this,g.browser)};this.getEngine=function(){return V.rgx.apply(this,g.engine)};this.getOS=function(){return V.rgx.apply(this,g.os)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}};this.getUA=function(){return q};this.setUA=function(s){q=s;return this};this.setUA(q)};return a})();function P(b,c,W){var a=0,d=0,Z=0,V={"dev":-6,"alpha":-5,"a":-5,"beta":-4,"b":-4,"RC":-3,"rc":-3,"#":-2,"p":1,"pl":1},X=function(e){e=(""+e).replace(/[_\-+]/g,".");e=e.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,".");return(!e.length?[-8]:e.split("."))},Y=function(e){return !e?0:(isNaN(e)?V[e]||-7:parseInt(e,10))};b=X(b);c=X(c);d=Math.max(b.length,c.length);for(a=0;a<d;a++){if(b[a]==c[a]){continue}b[a]=Y(b[a]);c[a]=Y(c[a]);if(b[a]<c[a]){Z=-1;break}else{if(b[a]>c[a]){Z=1;break}}}if(!W){return Z}switch(W){case">":case"gt":return(Z>0);case">=":case"ge":return(Z>=0);case"<=":case"le":return(Z<=0);case"==":case"=":case"eq":return(Z===0);case"<>":case"!=":case"ne":return(Z!==0);case"":case"<":case"lt":return(Z<0);default:return null}}var R=(function(){var V={define_property:(function(){return false}()),create_canvas:(function(){var W=document.createElement("canvas");return !!(W.getContext&&W.getContext("2d"))}()),return_response_type:function(W){try{if(U.inArray(W,["","text","document"])!==-1){return true}else{if(window.XMLHttpRequest){var Y=new XMLHttpRequest();Y.open("get","/");if("responseType" in Y){Y.responseType=W;if(Y.responseType!==W){return false}return true}}}}catch(X){}return false},use_data_uri:(function(){var W=new Image();W.onload=function(){V.use_data_uri=(W.width===1&&W.height===1)};setTimeout(function(){W.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1);return false}()),use_data_uri_over32kb:function(){return V.use_data_uri&&(Q.browser!=="IE"||Q.version>=9)},use_data_uri_of:function(W){return(V.use_data_uri&&W<33000||V.use_data_uri_over32kb())},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/)){return false}var W=document.createElement("input");W.setAttribute("type","file");return !W.disabled}};return function(W){var X=[].slice.call(arguments);X.shift();return U.typeOf(V[W])==="function"?V[W].apply(this,X):!!V[W]}}());var T=new S().getResult();var Q={can:R,uaParser:S,browser:T.browser.name,version:T.browser.version,os:T.os.name,osVersion:T.os.version,verComp:P,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};Q.OS=Q.os;if(D){Q.debug={runtime:true,events:false};Q.log=function(){function V(Y){W.appendChild(document.createTextNode(Y+"\n"))}var X=arguments[0];if(U.typeOf(X)==="string"){X=U.sprintf.apply(this,arguments)}if(window&&window.console&&window.console.log){window.console.log(X)}else{if(document){var W=document.getElementById("moxie-console");if(!W){W=document.createElement("pre");W.id="moxie-console";document.body.appendChild(W)}if(U.inArray(U.typeOf(X),["object","array"])!==-1){V(X)}else{W.appendChild(document.createTextNode(X+"\n"))}}}}}return Q});I("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(Q){function P(S,T){var R;for(R in S){if(S[R]===T){return R}}return null}return{RuntimeError:(function(){var R={NOT_INIT_ERR:1,EXCEPTION_ERR:3,NOT_SUPPORTED_ERR:9,JS_ERR:4};function S(T,U){this.code=T;this.name=P(R,T);this.message=this.name+(U||": RuntimeError "+this.code)}Q.extend(S,R);S.prototype=Error.prototype;return S}()),OperationNotAllowedException:(function(){function R(S){this.code=S;this.name="OperationNotAllowedException"}Q.extend(R,{NOT_ALLOWED_ERR:1});R.prototype=Error.prototype;return R}()),ImageError:(function(){var S={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};function R(T){this.code=T;this.name=P(S,T);this.message=this.name+": ImageError "+this.code}Q.extend(R,S);R.prototype=Error.prototype;return R}()),FileException:(function(){var S={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};function R(T){this.code=T;this.name=P(S,T);this.message=this.name+": FileException "+this.code}Q.extend(R,S);R.prototype=Error.prototype;return R}()),DOMException:(function(){var R={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function S(T){this.code=T;this.name=P(R,T);this.message=this.name+": DOMException "+this.code}Q.extend(S,R);S.prototype=Error.prototype;return S}()),EventException:(function(){function R(S){this.code=S;this.name="EventException"}Q.extend(R,{UNSPECIFIED_EVENT_TYPE_ERR:0});R.prototype=Error.prototype;return R}())}});I("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(Q){var S=function(X){if(typeof X!=="string"){return X}return document.getElementById(X)};var U=function(X,Z){if(!X.className){return false}var Y=new RegExp("(^|\\s+)"+Z+"(\\s+|$)");return Y.test(X.className)};var V=function(X,Y){if(!U(X,Y)){X.className=!X.className?Y:X.className.replace(/\s+$/,"")+" "+Y}};var R=function(X,Z){if(X.className){var Y=new RegExp("(^|\\s+)"+Z+"(\\s+|$)");X.className=X.className.replace(Y,function(c,a,b){return a===" "&&b===" "?" ":""})}};var P=function(X,Y){if(X.currentStyle){return X.currentStyle[Y]}else{if(window.getComputedStyle){return window.getComputedStyle(X,null)[Y]}}};var W=function(Z,Y){var b=0,c=0,e,a=document,X,f;Z=Z;Y=Y||a.body;function d(h){var g,j,i=0,k=0;if(h){j=h.getBoundingClientRect();g=a.compatMode==="CSS1Compat"?a.documentElement:a.body;i=j.left+g.scrollLeft;k=j.top+g.scrollTop}return{x:i,y:k}}if(Z&&Z.getBoundingClientRect&&Q.browser==="IE"&&(!a.documentMode||a.documentMode<8)){X=d(Z);f=d(Y);return{x:X.x-f.x,y:X.y-f.y}}e=Z;while(e&&e!=Y&&e.nodeType){b+=e.offsetLeft||0;c+=e.offsetTop||0;e=e.offsetParent}e=Z.parentNode;while(e&&e!=Y&&e.nodeType){b-=e.scrollLeft||0;c-=e.scrollTop||0;e=e.parentNode}return{x:b,y:c}};var T=function(X){return{w:X.offsetWidth||X.clientWidth,h:X.offsetHeight||X.clientHeight}};return{get:S,hasClass:U,addClass:V,removeClass:R,getStyle:P,getPos:W,getSize:T}});I("moxie/core/EventTarget",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic"],function(T,R,S){var Q={};function P(){this.uid=S.guid()}S.extend(P.prototype,{init:function(){if(!this.uid){this.uid=S.guid("uid_")}},addEventListener:function(U,X,Y,Z){var V=this,W;if(!this.hasOwnProperty("uid")){this.uid=S.guid("uid_")}U=S.trim(U);if(/\s/.test(U)){S.each(U.split(/\s+/),function(a){V.addEventListener(a,X,Y,Z)});return}U=U.toLowerCase();Y=parseInt(Y,10)||0;W=Q[this.uid]&&Q[this.uid][U]||[];W.push({fn:X,priority:Y,scope:Z||this});if(!Q[this.uid]){Q[this.uid]={}}Q[this.uid][U]=W},hasEventListener:function(U){var V;if(U){U=U.toLowerCase();V=Q[this.uid]&&Q[this.uid][U]}else{V=Q[this.uid]}return V?V:false},removeEventListener:function(U,X){var W=this,Y,V;U=U.toLowerCase();if(/\s/.test(U)){S.each(U.split(/\s+/),function(Z){W.removeEventListener(Z,X)});return}Y=Q[this.uid]&&Q[this.uid][U];if(Y){if(X){for(V=Y.length-1;V>=0;V--){if(Y[V].fn===X){Y.splice(V,1);break}}}else{Y=[]}if(!Y.length){delete Q[this.uid][U];if(S.isEmptyObj(Q[this.uid])){delete Q[this.uid]}}}},removeAllEventListeners:function(){if(Q[this.uid]){delete Q[this.uid]}},dispatchEvent:function(Y){var Z,W,U,c,b={},X=true,a;if(S.typeOf(Y)!=="string"){c=Y;if(S.typeOf(c.type)==="string"){Y=c.type;if(c.total!==a&&c.loaded!==a){b.total=c.total;b.loaded=c.loaded}b.async=c.async||false}else{throw new R.EventException(R.EventException.UNSPECIFIED_EVENT_TYPE_ERR)}}if(Y.indexOf("::")!==-1){(function(d){Z=d[0];Y=d[1]}(Y.split("::")))}else{Z=this.uid}Y=Y.toLowerCase();W=Q[Z]&&Q[Z][Y];if(W){W.sort(function(e,d){return d.priority-e.priority});U=[].slice.call(arguments);U.shift();b.type=Y;U.unshift(b);if(D&&T.debug.events){T.log("Event '%s' fired on %u",b.type,Z)}var V=[];S.each(W,function(d){U[0].target=d.scope;if(b.async){V.push(function(e){setTimeout(function(){e(d.fn.apply(d.scope,U)===false)},1)})}else{V.push(function(e){e(d.fn.apply(d.scope,U)===false)})}});if(V.length){S.inSeries(V,function(d){X=!d})}}return X},bindOnce:function(U,W,Y,Z){var V=this;V.bind.call(this,U,function X(){V.unbind(U,X);return W.apply(this,arguments)},Y,Z)},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(V){var U=this;this.bind(V.join(" "),function(W){var X="on"+W.type.toLowerCase();if(S.typeOf(this[X])==="function"){this[X].apply(this,arguments)}});S.each(V,function(W){W="on"+W.toLowerCase(W);if(S.typeOf(U[W])==="undefined"){U[W]=null}})}});P.instance=new P();return P});I("moxie/runtime/Runtime",["moxie/core/utils/Env","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(V,U,T,Q){var S={},P={};function R(Z,c,d,e,Y){var b=this,W,a=U.guid(c+"_"),X=Y||"browser";Z=Z||{};P[a]=this;d=U.extend({access_binary:false,access_image_binary:false,display_media:false,do_cors:false,drag_and_drop:false,filter_by_extension:true,resize_image:false,report_upload_progress:false,return_response_headers:false,return_response_type:false,return_status_code:true,send_custom_headers:false,select_file:false,select_folder:false,select_multiple:true,send_binary_string:false,send_browser_cookies:true,send_multipart:true,slice_blob:false,stream_upload:false,summon_file_dialog:false,upload_filesize:true,use_http_method:true},d);if(Z.preferred_caps){X=R.getMode(e,Z.preferred_caps,X)}if(D&&V.debug.runtime){V.log("\tdefault mode: %s",X)}W=(function(){var f={};return{exec:function(h,j,g,i){if(W[j]){if(!f[h]){f[h]={context:this,instance:new W[j]()}}if(f[h].instance[g]){return f[h].instance[g].apply(this,i)}}},removeInstance:function(g){delete f[g]},removeAllInstances:function(){var g=this;U.each(f,function(h,i){if(U.typeOf(h.instance.destroy)==="function"){h.instance.destroy.call(h.context)}g.removeInstance(i)})}}}());U.extend(this,{initialized:false,uid:a,type:c,mode:R.getMode(e,(Z.required_caps),X),shimid:a+"_container",clients:0,options:Z,can:function(h,i){var g=arguments[2]||d;if(U.typeOf(h)==="string"&&U.typeOf(i)==="undefined"){h=R.parseCaps(h)}if(U.typeOf(h)==="object"){for(var f in h){if(!this.can(f,h[f],g)){return false}}return true}if(U.typeOf(g[h])==="function"){return g[h].call(this,i)}else{return(i===g[h])}},getShimContainer:function(){var g,f=T.get(this.shimid);if(!f){g=T.get(this.options.container)||document.body;f=document.createElement("div");f.id=this.shimid;f.className="moxie-shim moxie-shim-"+this.type;U.extend(f.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});g.appendChild(f);g=null}return f},getShim:function(){return W},shimExec:function(g,f){var h=[].slice.call(arguments,2);return b.getShim().exec.call(this,this.uid,g,f,h)},exec:function(g,f){var h=[].slice.call(arguments,2);if(b[g]&&b[g][f]){return b[g][f].apply(this,h)}return b.shimExec.apply(this,arguments)},destroy:function(){if(!b){return}var f=T.get(this.shimid);if(f){f.parentNode.removeChild(f)}if(W){W.removeAllInstances()}this.unbindAll();delete P[this.uid];this.uid=null;a=b=W=f=null}});if(this.mode&&Z.required_caps&&!this.can(Z.required_caps)){this.mode=false}}R.order="html5,flash,silverlight,html4";R.getRuntime=function(W){return P[W]?P[W]:false};R.addConstructor=function(W,X){X.prototype=Q.instance;S[W]=X};R.getConstructor=function(W){return S[W]||null};R.getInfo=function(W){var X=R.getRuntime(W);if(X){return{uid:X.uid,type:X.type,mode:X.mode,can:function(){return X.can.apply(X,arguments)}}}return null};R.parseCaps=function(W){var X={};if(U.typeOf(W)!=="string"){return W||{}}U.each(W.split(","),function(Y){X[Y]=true});return X};R.can=function(W,a){var Z,Y=R.getConstructor(W),X;if(Y){Z=new Y({required_caps:a});X=Z.mode;Z.destroy();return !!X}return false};R.thatCan=function(Z,Y){var X=(Y||R.order).split(/\s*,\s*/);for(var W in X){if(R.can(X[W],Z)){return X[W]}}return null};R.getMode=function(Z,Y,X){var W=null;if(U.typeOf(X)==="undefined"){X="browser"}if(Y&&!U.isEmptyObj(Z)){U.each(Y,function(c,b){if(Z.hasOwnProperty(b)){var a=Z[b](c);if(typeof(a)==="string"){a=[a]}if(!W){W=a}else{if(!(W=U.arrayIntersect(W,a))){if(D&&V.debug.runtime){V.log("\t\t%c: %v (conflicting mode requested: %s)",b,c,a)}return(W=false)}}}if(D&&V.debug.runtime){V.log("\t\t%c: %v (compatible modes: %s)",b,c,W)}});if(W){return U.inArray(X,W)!==-1?X:W[0]}else{if(W===false){return false}}}return X};R.capTrue=function(){return true};R.capFalse=function(){return false};R.capTest=function(W){return function(){return !!W}};return R});I("moxie/runtime/RuntimeClient",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(T,R,S,P){return function Q(){var U;S.extend(this,{connectRuntime:function(X){var Y=this,V;function W(b){var Z,a;if(!b.length){Y.trigger("RuntimeError",new R.RuntimeError(R.RuntimeError.NOT_INIT_ERR));U=null;return}Z=b.shift().toLowerCase();a=P.getConstructor(Z);if(!a){if(D&&T.debug.runtime){T.log("Constructor for '%s' runtime is not available.",Z)}W(b);return}if(D&&T.debug.runtime){T.log("Trying runtime: %s",Z);T.log(X)}U=new a(X);U.bind("Init",function(){U.initialized=true;if(D&&T.debug.runtime){T.log("Runtime '%s' initialized",U.type)}setTimeout(function(){U.clients++;Y.ruid=U.uid;Y.trigger("RuntimeInit",U)},1)});U.bind("Error",function(){if(D&&T.debug.runtime){T.log("Runtime '%s' failed to initialize",U.type)}U.destroy();W(b)});U.bind("Exception",function(c,d){var f=d.name+"(#"+d.code+")"+(d.message?", from: "+d.message:"");if(D&&T.debug.runtime){T.log("Runtime '%s' has thrown an exception: %s",this.type,f)}Y.trigger("RuntimeError",new R.RuntimeError(R.RuntimeError.EXCEPTION_ERR,f))});if(D&&T.debug.runtime){T.log("\tselected mode: %s",U.mode)}if(!U.mode){U.trigger("Error");return}U.init()}if(S.typeOf(X)==="string"){V=X}else{if(S.typeOf(X.ruid)==="string"){V=X.ruid}}if(V){U=P.getRuntime(V);if(U){Y.ruid=V;U.clients++;return U}else{throw new R.RuntimeError(R.RuntimeError.NOT_INIT_ERR)}}W((X.runtime_order||P.order).split(/\s*,\s*/))},disconnectRuntime:function(){if(U&&--U.clients<=0){U.destroy()}U=null},getRuntime:function(){if(U&&U.uid){return U}return U=null},exec:function(){return U?U.exec.apply(this,arguments):null},can:function(V){return U?U.can(V):false}})}});I("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(T,P,S){var R={};function Q(U,V){function W(a,Z,X){var Y,b=R[this.uid];if(T.typeOf(b)!=="string"||!b.length){return null}Y=new Q(null,{type:X,size:Z-a});Y.detach(b.substr(a,Y.size));return Y}S.call(this);if(U){this.connectRuntime(U)}if(!V){V={}}else{if(T.typeOf(V)==="string"){V={data:V}}}T.extend(this,{uid:V.uid||T.guid("uid_"),ruid:U,size:V.size||0,type:V.type||"",slice:function(Z,Y,X){if(this.isDetached()){return W.apply(this,arguments)}return this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),Z,Y,X)},getSource:function(){if(!R[this.uid]){return null}return R[this.uid]},detach:function(Y){if(this.ruid){this.getRuntime().exec.call(this,"Blob","destroy");this.disconnectRuntime();this.ruid=null}Y=Y||"";if(Y.substr(0,5)=="data:"){var X=Y.indexOf(";base64,");this.type=Y.substring(5,X);Y=P.atob(Y.substring(X+8))}this.size=Y.length;R[this.uid]=Y},isDetached:function(){return !this.ruid&&T.typeOf(R[this.uid])==="string"},destroy:function(){this.detach();delete R[this.uid]}});if(V.data){this.detach(V.data)}else{R[this.uid]=V}}return Q});I("moxie/core/I18n",["moxie/core/utils/Basic"],function(Q){var P={};return{addI18n:function(R){return Q.extend(P,R)},translate:function(R){return P[R]||R},_:function(R){return this.translate(R)},sprintf:function(R){var S=[].slice.call(arguments,1);return R.replace(/%[a-z]/g,function(){var T=S.shift();return Q.typeOf(T)!=="undefined"?T:""})}}});I("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(R,P){var S="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe";var Q={mimes:{},extensions:{},addMimeType:function(X){var W=X.split(/,/),U,V,T;for(U=0;U<W.length;U+=2){T=W[U+1].split(/ /);for(V=0;V<T.length;V++){this.mimes[T[V]]=W[U]}this.extensions[W[U]]=T}},extList2mimes:function(T,a){var Y=this,W,V,U,Z,X=[];for(V=0;V<T.length;V++){W=T[V].extensions.toLowerCase().split(/\s*,\s*/);for(U=0;U<W.length;U++){if(W[U]==="*"){return[]}Z=Y.mimes[W[U]];if(a&&/^\w+$/.test(W[U])){X.push("."+W[U])}else{if(Z&&R.inArray(Z,X)===-1){X.push(Z)}else{if(!Z){return[]}}}}}return X},mimes2exts:function(T){var U=this,V=[];R.each(T,function(W){W=W.toLowerCase();if(W==="*"){V=[];return false}var X=W.match(/^(\w+)\/(\*|\w+)$/);if(X){if(X[2]==="*"){R.each(U.extensions,function(Z,Y){if((new RegExp("^"+X[1]+"/")).test(Y)){[].push.apply(V,U.extensions[Y])}})}else{if(U.extensions[W]){[].push.apply(V,U.extensions[W])}}}});return V},mimes2extList:function(T){var U=[],V=[];if(R.typeOf(T)==="string"){T=R.trim(T).split(/\s*,\s*/)}V=this.mimes2exts(T);U.push({title:P.translate("Files"),extensions:V.length?V.join(","):"*"});U.mimes=T;return U},getFileExtension:function(T){var U=T&&T.match(/\.([^.]+)$/);if(U){return U[1].toLowerCase()}return""},getFileMime:function(T){return this.mimes[this.getFileExtension(T)]||""}};Q.addMimeType(S);return Q});I("moxie/file/FileInput",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Mime","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/I18n","moxie/runtime/Runtime","moxie/runtime/RuntimeClient"],function(S,T,W,Z,X,R,U,Y,Q){var V=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];function P(b){if(D){T.log("Instantiating FileInput...")}var c,d,a;if(S.inArray(S.typeOf(b),["string","node"])!==-1){b={browse_button:b}}d=Z.get(b.browse_button);if(!d){throw new X.DOMException(X.DOMException.NOT_FOUND_ERR)}a={accept:[{title:U.translate("All Files"),extensions:"*"}],multiple:false,required_caps:false,container:d.parentNode||document.body};b=S.extend({},a,b);if(typeof(b.required_caps)==="string"){b.required_caps=Y.parseCaps(b.required_caps)}if(typeof(b.accept)==="string"){b.accept=W.mimes2extList(b.accept)}c=Z.get(b.container);if(!c){c=document.body}if(Z.getStyle(c,"position")==="static"){c.style.position="relative"}c=d=null;Q.call(this);S.extend(this,{uid:S.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){var e=this;e.bind("RuntimeInit",function(f,g){e.ruid=g.uid;e.shimid=g.shimid;e.bind("Ready",function(){e.trigger("Refresh")},999);e.bind("Refresh",function(){var j,h,l,k,i;l=Z.get(b.browse_button);k=Z.get(g.shimid);if(l){j=Z.getPos(l,Z.get(b.container));h=Z.getSize(l);i=parseInt(Z.getStyle(l,"z-index"),10)||0;if(k){S.extend(k.style,{top:j.y+"px",left:j.x+"px",width:h.w+"px",height:h.h+"px",zIndex:i+1})}}k=l=null});g.exec.call(e,"FileInput","init",b)});e.connectRuntime(S.extend({},b,{required_caps:{select_file:true}}))},getOption:function(e){return b[e]},setOption:function(f,g){if(!b.hasOwnProperty(f)){return}var e=b[f];switch(f){case"accept":if(typeof(g)==="string"){g=W.mimes2extList(g)}break;case"container":case"required_caps":throw new X.FileException(X.FileException.NO_MODIFICATION_ALLOWED_ERR)}b[f]=g;this.exec("FileInput","setOption",f,g);this.trigger("OptionChanged",f,g,e)},disable:function(f){var e=this.getRuntime();if(e){this.exec("FileInput","disable",S.typeOf(f)==="undefined"?true:f)}},refresh:function(){this.trigger("Refresh")},destroy:function(){var e=this.getRuntime();if(e){e.exec.call(this,"FileInput","destroy");this.disconnectRuntime()}if(S.typeOf(this.files)==="array"){S.each(this.files,function(f){f.destroy()})}this.files=null;this.unbindAll()}});this.handleEventProps(V)}P.prototype=R.instance;return P});I("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(S,R,P){function Q(T,W){if(!W){W={}}P.apply(this,arguments);if(!this.type){this.type=R.getFileMime(W.name)}var V;if(W.name){V=W.name.replace(/\\/g,"/");V=V.substr(V.lastIndexOf("/")+1)}else{if(this.type){var U=this.type.split("/")[0];V=S.guid((U!==""?U:"file")+"_");if(R.extensions[this.type]){V+="."+R.extensions[this.type][0]}}}S.extend(this,{name:V||S.guid("file_"),relativePath:"",lastModifiedDate:W.lastModifiedDate||(new Date()).toLocaleString()})}Q.prototype=P.prototype;return Q});I("moxie/file/FileDrop",["moxie/core/I18n","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/core/utils/Env","moxie/file/File","moxie/runtime/RuntimeClient","moxie/core/EventTarget","moxie/core/utils/Mime"],function(V,Z,Y,S,T,U,Q,R,X){var W=["ready","dragenter","dragleave","drop","error"];function P(b){if(D){T.log("Instantiating FileDrop...")}var a=this,c;if(typeof(b)==="string"){b={drop_zone:b}}c={accept:[{title:V.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:true}};b=typeof(b)==="object"?S.extend({},c,b):c;b.container=Z.get(b.drop_zone)||document.body;if(Z.getStyle(b.container,"position")==="static"){b.container.style.position="relative"}if(typeof(b.accept)==="string"){b.accept=X.mimes2extList(b.accept)}Q.call(a);S.extend(a,{uid:S.guid("uid_"),ruid:null,files:null,init:function(){a.bind("RuntimeInit",function(d,f){a.ruid=f.uid;f.exec.call(a,"FileDrop","init",b);a.dispatchEvent("ready")});a.connectRuntime(b)},destroy:function(){var d=this.getRuntime();if(d){d.exec.call(this,"FileDrop","destroy");this.disconnectRuntime()}this.files=null;this.unbindAll()}});this.handleEventProps(W)}P.prototype=R.instance;return P});I("moxie/file/FileReader",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/Exceptions","moxie/core/EventTarget","moxie/file/Blob","moxie/runtime/RuntimeClient"],function(S,T,W,R,U,Q){var V=["loadstart","progress","load","abort","error","loadend"];function P(){Q.call(this);S.extend(this,{uid:S.guid("uid_"),readyState:P.EMPTY,result:null,error:null,readAsBinaryString:function(Y){X.call(this,"readAsBinaryString",Y)},readAsDataURL:function(Y){X.call(this,"readAsDataURL",Y)},readAsText:function(Y){X.call(this,"readAsText",Y)},abort:function(){this.result=null;if(S.inArray(this.readyState,[P.EMPTY,P.DONE])!==-1){return}else{if(this.readyState===P.LOADING){this.readyState=P.DONE}}this.exec("FileReader","abort");this.trigger("abort");this.trigger("loadend")},destroy:function(){this.abort();this.exec("FileReader","destroy");this.disconnectRuntime();this.unbindAll()}});this.handleEventProps(V);this.bind("Error",function(Y,Z){this.readyState=P.DONE;this.error=Z},999);this.bind("Load",function(Y){this.readyState=P.DONE},999);function X(a,Z){var b=this;this.trigger("loadstart");if(this.readyState===P.LOADING){this.trigger("error",new W.DOMException(W.DOMException.INVALID_STATE_ERR));this.trigger("loadend");return}if(!(Z instanceof U)){this.trigger("error",new W.DOMException(W.DOMException.NOT_FOUND_ERR));this.trigger("loadend");return}this.result=null;this.readyState=P.LOADING;if(Z.isDetached()){var Y=Z.getSource();switch(a){case"readAsText":case"readAsBinaryString":this.result=Y;break;case"readAsDataURL":this.result="data:"+Z.type+";base64,"+T.btoa(Y);break}this.readyState=P.DONE;this.trigger("load");this.trigger("loadend")}else{this.connectRuntime(Z.ruid);this.exec("FileReader","read",a,Z)}}}P.EMPTY=0;P.LOADING=1;P.DONE=2;P.prototype=R.instance;return P});I("moxie/core/utils/Url",["moxie/core/utils/Basic"],function(R){var S=function(a,Y){var X=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],W=X.length,V={http:80,https:443},c={},U=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?(\[[\da-fA-F:]+\]|[^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,Z=U.exec(a||""),b,T=/^\/\/\w/.test(a);switch(R.typeOf(Y)){case"undefined":Y=S(document.location.href,false);break;case"string":Y=S(Y,false);break}while(W--){if(Z[W]){c[X[W]]=Z[W]}}b=!T&&!c.scheme;if(T||b){c.scheme=Y.scheme}if(b){c.host=Y.host;c.port=Y.port;var d="";if(/^[^\/]/.test(c.path)){d=Y.path;if(/\/[^\/]*\.[^\/]*$/.test(d)){d=d.replace(/\/[^\/]+$/,"/")}else{d=d.replace(/\/?$/,"/")}}c.path=d+(c.path||"")}if(!c.port){c.port=V[c.scheme]||80}c.port=parseInt(c.port,10);if(!c.path){c.path="/"}delete c.source;return c};var P=function(U){var V={http:80,https:443},T=typeof(U)==="object"?U:S(U);return T.scheme+"://"+T.host+(T.port!==V[T.scheme]?":"+T.port:"")+T.path+(T.query?T.query:"")};var Q=function(T){function U(V){return[V.scheme,V.host,V.port].join("/")}if(typeof T==="string"){T=S(T)}return U(S())===U(T)};return{parseUrl:S,resolveUrl:P,hasSameOrigin:Q}});I("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(S,R,P){function Q(){this.uid=S.guid("uid_");R.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}Q.prototype=P.instance;return Q});I("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(R,Q,P){return function(){Q.call(this);R.extend(this,{uid:R.guid("uid_"),readAsBinaryString:function(T){return S.call(this,"readAsBinaryString",T)},readAsDataURL:function(T){return S.call(this,"readAsDataURL",T)},readAsText:function(T){return S.call(this,"readAsText",T)}});function S(W,U){if(U.isDetached()){var Z=U.getSource();switch(W){case"readAsBinaryString":return Z;case"readAsDataURL":return"data:"+U.type+";base64,"+P.btoa(Z);case"readAsText":var V="";for(var T=0,X=Z.length;T<X;T++){V+=String.fromCharCode(Z[T])}return V}}else{var Y=this.connectRuntime(U.ruid).exec.call(this,"FileReaderSync","read",W,U);this.disconnectRuntime();return Y}}}});I("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(R,S,Q){function P(){var U,T=[];S.extend(this,{append:function(X,Y){var W=this,V=S.typeOf(Y);if(Y instanceof Q){U={name:X,value:Y}}else{if("array"===V){X+="[]";S.each(Y,function(Z){W.append(X,Z)})}else{if("object"===V){S.each(Y,function(a,Z){W.append(X+"["+Z+"]",a)})}else{if("null"===V||"undefined"===V||"number"===V&&isNaN(Y)){W.append(X,"false")}else{T.push({name:X,value:Y.toString()})}}}}},hasBlob:function(){return !!this.getBlob()},getBlob:function(){return U&&U.value||null},getBlobName:function(){return U&&U.name||null},each:function(V){S.each(T,function(W){V(W.value,W.name)});if(U){V(U.value,U.name)}},destroy:function(){U=null;T=[]}})}return P});I("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(b,W,S,X,f,Y,R,e,g,a,P,U){var V={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};function Z(){this.uid=b.guid("uid_")}Z.prototype=S.instance;var c=["loadstart","progress","abort","error","load","timeout","loadend"];var T=1,d=2;function Q(){var Ag=this,i={timeout:0,readyState:Q.UNSENT,withCredentials:false,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},t=true,Ab,x,Aa={},o,Af,n=null,j=null,r=false,l=false,Ad=false,m=false,s=false,Ah=false,z,Ae,u=null,p=null,v={},k,w="",h;b.extend(this,i,{uid:b.guid("uid_"),upload:new Z(),open:function(Al,Aj,Am,An,Ai){var Ak;if(!Al||!Aj){throw new W.DOMException(W.DOMException.SYNTAX_ERR)}if(/[\u0100-\uffff]/.test(Al)||X.utf8_encode(Al)!==Al){throw new W.DOMException(W.DOMException.SYNTAX_ERR)}if(!!~b.inArray(Al.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])){x=Al.toUpperCase()}if(!!~b.inArray(x,["CONNECT","TRACE","TRACK"])){throw new W.DOMException(W.DOMException.SECURITY_ERR)}Aj=X.utf8_encode(Aj);Ak=f.parseUrl(Aj);Ah=f.hasSameOrigin(Ak);Ab=f.resolveUrl(Aj);if((An||Ai)&&!Ah){throw new W.DOMException(W.DOMException.INVALID_ACCESS_ERR)}o=An||Ak.user;Af=Ai||Ak.pass;t=Am||true;if(t===false&&(y("timeout")||y("withCredentials")||y("responseType")!=="")){throw new W.DOMException(W.DOMException.INVALID_ACCESS_ERR)}r=!t;l=false;Aa={};q.call(this);y("readyState",Q.OPENED);this.dispatchEvent("readystatechange")},setRequestHeader:function(Aj,Ak){var Ai=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(y("readyState")!==Q.OPENED||l){throw new W.DOMException(W.DOMException.INVALID_STATE_ERR)}if(/[\u0100-\uffff]/.test(Aj)||X.utf8_encode(Aj)!==Aj){throw new W.DOMException(W.DOMException.SYNTAX_ERR)}Aj=b.trim(Aj).toLowerCase();if(!!~b.inArray(Aj,Ai)||/^(proxy\-|sec\-)/.test(Aj)){return false}if(!Aa[Aj]){Aa[Aj]=Ak}else{Aa[Aj]+=", "+Ak}return true},hasRequestHeader:function(Ai){return Ai&&Aa[Ai.toLowerCase()]||false},getAllResponseHeaders:function(){return w||""},getResponseHeader:function(Ai){Ai=Ai.toLowerCase();if(s||!!~b.inArray(Ai,["set-cookie","set-cookie2"])){return null}if(w&&w!==""){if(!h){h={};b.each(w.split(/\r\n/),function(Ak){var Aj=Ak.split(/:\s+/);if(Aj.length===2){Aj[0]=b.trim(Aj[0]);h[Aj[0].toLowerCase()]={header:Aj[0],value:b.trim(Aj[1])}}})}if(h.hasOwnProperty(Ai)){return h[Ai].header+": "+h[Ai].value}}return null},overrideMimeType:function(Ai){var Aj,Ak;if(!!~b.inArray(y("readyState"),[Q.LOADING,Q.DONE])){throw new W.DOMException(W.DOMException.INVALID_STATE_ERR)}Ai=b.trim(Ai.toLowerCase());if(/;/.test(Ai)&&(Aj=Ai.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))){Ai=Aj[1];if(Aj[2]){Ak=Aj[2]}}if(!U.mimes[Ai]){throw new W.DOMException(W.DOMException.SYNTAX_ERR)}u=Ai;p=Ak},send:function(Ak,Aj){if(b.typeOf(Aj)==="string"){v={ruid:Aj}}else{if(!Aj){v={}}else{v=Aj}}if(this.readyState!==Q.OPENED||l){throw new W.DOMException(W.DOMException.INVALID_STATE_ERR)}if(Ak instanceof e){v.ruid=Ak.ruid;j=Ak.type||"application/octet-stream"}else{if(Ak instanceof a){if(Ak.hasBlob()){var Ai=Ak.getBlob();v.ruid=Ai.ruid;j=Ai.type||"application/octet-stream"}}else{if(typeof Ak==="string"){n="UTF-8";j="text/plain;charset=UTF-8";Ak=X.utf8_encode(Ak)}}}if(!this.withCredentials){this.withCredentials=(v.required_caps&&v.required_caps.send_browser_cookies)&&!Ah}Ad=(!r&&this.upload.hasEventListener());s=false;m=!Ak;if(!r){l=true}Ac.call(this,Ak)},abort:function(){s=true;r=false;if(!~b.inArray(y("readyState"),[Q.UNSENT,Q.OPENED,Q.DONE])){y("readyState",Q.DONE);l=false;if(k){k.getRuntime().exec.call(k,"XMLHttpRequest","abort",m)}else{throw new W.DOMException(W.DOMException.INVALID_STATE_ERR)}m=true}else{y("readyState",Q.UNSENT)}},destroy:function(){if(k){if(b.typeOf(k.destroy)==="function"){k.destroy()}k=null}this.unbindAll();if(this.upload){this.upload.unbindAll();this.upload=null}}});this.handleEventProps(c.concat(["readystatechange"]));this.upload.handleEventProps(c);function y(Ai,Aj){if(!i.hasOwnProperty(Ai)){return}if(arguments.length===1){return P.can("define_property")?i[Ai]:Ag[Ai]}else{if(P.can("define_property")){i[Ai]=Aj}else{Ag[Ai]=Aj}}}function Ac(Al){var Ai=this;z=new Date().getTime();k=new R();function Ak(){if(k){k.destroy();k=null}Ai.dispatchEvent("loadend");Ai=null}function Aj(Am){k.bind("LoadStart",function(An){y("readyState",Q.LOADING);Ai.dispatchEvent("readystatechange");Ai.dispatchEvent(An);if(Ad){Ai.upload.dispatchEvent(An)}});k.bind("Progress",function(An){if(y("readyState")!==Q.LOADING){y("readyState",Q.LOADING);Ai.dispatchEvent("readystatechange")}Ai.dispatchEvent(An)});k.bind("UploadProgress",function(An){if(Ad){Ai.upload.dispatchEvent({type:"progress",lengthComputable:false,total:An.total,loaded:An.loaded})}});k.bind("Load",function(An){y("readyState",Q.DONE);y("status",Number(Am.exec.call(k,"XMLHttpRequest","getStatus")||0));y("statusText",V[y("status")]||"");y("response",Am.exec.call(k,"XMLHttpRequest","getResponse",y("responseType")));if(!!~b.inArray(y("responseType"),["text",""])){y("responseText",y("response"))}else{if(y("responseType")==="document"){y("responseXML",y("response"))}}w=Am.exec.call(k,"XMLHttpRequest","getAllResponseHeaders");Ai.dispatchEvent("readystatechange");if(y("status")>0){if(Ad){Ai.upload.dispatchEvent(An)}Ai.dispatchEvent(An)}else{s=true;Ai.dispatchEvent("error")}Ak()});k.bind("Abort",function(An){Ai.dispatchEvent(An);Ak()});k.bind("Error",function(An){s=true;y("readyState",Q.DONE);Ai.dispatchEvent("readystatechange");m=true;Ai.dispatchEvent(An);Ak()});Am.exec.call(k,"XMLHttpRequest","send",{url:Ab,method:x,async:t,user:o,password:Af,headers:Aa,mimeType:j,encoding:n,responseType:Ai.responseType,withCredentials:Ai.withCredentials,options:v},Al)}if(typeof(v.required_caps)==="string"){v.required_caps=Y.parseCaps(v.required_caps)}v.required_caps=b.extend({},v.required_caps,{return_response_type:Ai.responseType});if(Al instanceof a){v.required_caps.send_multipart=true}if(!b.isEmptyObj(Aa)){v.required_caps.send_custom_headers=true}if(!Ah){v.required_caps.do_cors=true}if(v.ruid){Aj(k.connectRuntime(v))}else{k.bind("RuntimeInit",function(Am,An){Aj(An)});k.bind("RuntimeError",function(Am,An){Ai.dispatchEvent("RuntimeError",An)});k.connectRuntime(v)}}function q(){y("responseText","");y("responseXML",null);y("response",null);y("status",0);y("statusText","");z=Ae=null}}Q.UNSENT=0;Q.OPENED=1;Q.HEADERS_RECEIVED=2;Q.LOADING=3;Q.DONE=4;Q.prototype=S.instance;return Q});I("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(T,P,R,Q){function S(){var a,Z,W,U,Y,b;R.call(this);T.extend(this,{uid:T.guid("uid_"),state:S.IDLE,result:null,transport:function(h,d,g){var e=this;g=T.extend({chunk_size:204798},g);if((a=g.chunk_size%3)){g.chunk_size+=3-a}b=g.chunk_size;X.call(this);W=h;U=h.length;if(T.typeOf(g)==="string"||g.ruid){V.call(e,d,this.connectRuntime(g))}else{var f=function(i,j){e.unbind("RuntimeInit",f);V.call(e,d,j)};this.bind("RuntimeInit",f);this.connectRuntime(g)}},abort:function(){var d=this;d.state=S.IDLE;if(Z){Z.exec.call(d,"Transporter","clear");d.trigger("TransportingAborted")}X.call(d)},destroy:function(){this.unbindAll();Z=null;this.disconnectRuntime();X.call(this)}});function X(){U=Y=0;W=this.result=null}function V(d,f){var e=this;Z=f;e.bind("TransportingProgress",function(g){Y=g.loaded;if(Y<U&&T.inArray(e.state,[S.IDLE,S.DONE])===-1){c.call(e)}},999);e.bind("TransportingComplete",function(){Y=U;e.state=S.DONE;W=null;e.result=Z.exec.call(e,"Transporter","getAsBlob",d||"")},999);e.state=S.BUSY;e.trigger("TransportingStarted");c.call(e)}function c(){var e=this,d,f=U-Y;if(b>f){b=f}d=P.btoa(W.substr(Y,b));Z.exec.call(e,"Transporter","receive",d,U)}}S.IDLE=0;S.BUSY=1;S.DONE=2;S.prototype=Q.instance;return S});I("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode"],function(U,d,b,P,a,c,S,R,V,T,Z,W,X){var Q=["progress","load","error","resize","embedded"];function Y(){S.call(this);U.extend(this,{uid:U.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){e.apply(this,arguments)},resize:function(o){var q=this;var m;var k;var j={x:0,y:0,width:q.width,height:q.height};var n=U.extendIf({width:q.width,height:q.height,type:q.type||"image/jpeg",quality:90,crop:false,fit:true,preserveHeaders:true,resample:"default",multipass:true},o);try{if(!q.size){throw new b.DOMException(b.DOMException.INVALID_STATE_ERR)}if(q.width>Y.MAX_RESIZE_WIDTH||q.height>Y.MAX_RESIZE_HEIGHT){throw new b.ImageError(b.ImageError.MAX_RESOLUTION_ERR)}m=(q.meta&&q.meta.tiff&&q.meta.tiff.Orientation)||1;if(U.inArray(m,[5,6,7,8])!==-1){var l=n.width;n.width=n.height;n.height=l}if(n.crop){k=Math.max(n.width/q.width,n.height/q.height);if(o.fit){j.width=Math.min(Math.ceil(n.width/k),q.width);j.height=Math.min(Math.ceil(n.height/k),q.height);k=n.width/j.width}else{j.width=Math.min(n.width,q.width);j.height=Math.min(n.height,q.height);k=1}if(typeof(n.crop)==="boolean"){n.crop="cc"}switch(n.crop.toLowerCase().replace(/_/,"-")){case"rb":case"right-bottom":j.x=q.width-j.width;j.y=q.height-j.height;break;case"cb":case"center-bottom":j.x=Math.floor((q.width-j.width)/2);j.y=q.height-j.height;break;case"lb":case"left-bottom":j.x=0;j.y=q.height-j.height;break;case"lt":case"left-top":j.x=0;j.y=0;break;case"ct":case"center-top":j.x=Math.floor((q.width-j.width)/2);j.y=0;break;case"rt":case"right-top":j.x=q.width-j.width;j.y=0;break;case"rc":case"right-center":case"right-middle":j.x=q.width-j.width;j.y=Math.floor((q.height-j.height)/2);break;case"lc":case"left-center":case"left-middle":j.x=0;j.y=Math.floor((q.height-j.height)/2);break;case"cc":case"center-center":case"center-middle":default:j.x=Math.floor((q.width-j.width)/2);j.y=Math.floor((q.height-j.height)/2)}j.x=Math.max(j.x,0);j.y=Math.max(j.y,0)}else{k=Math.min(n.width/q.width,n.height/q.height)}this.exec("Image","resize",j,k,n)}catch(p){q.trigger("error",p.code)}},downsize:function(k){var l={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:false,preserveHeaders:true,resample:"default"},j;if(typeof(k)==="object"){j=U.extend(l,k)}else{j=U.extend(l,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]})}this.resize(j)},crop:function(k,j,l){this.downsize(k,j,true,l)},getAsCanvas:function(){if(!V.can("create_canvas")){throw new b.RuntimeError(b.RuntimeError.NOT_SUPPORTED_ERR)}return this.exec("Image","getAsCanvas")},getAsBlob:function(j,k){if(!this.size){throw new b.DOMException(b.DOMException.INVALID_STATE_ERR)}return this.exec("Image","getAsBlob",j||"image/jpeg",k||90)},getAsDataURL:function(j,k){if(!this.size){throw new b.DOMException(b.DOMException.INVALID_STATE_ERR)}return this.exec("Image","getAsDataURL",j||"image/jpeg",k||90)},getAsBinaryString:function(j,l){var k=this.getAsDataURL(j,l);return X.atob(k.substring(k.indexOf("base64,")+7))},embed:function(k,n){var p=this,q;var o=U.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90},n);function m(r,v){var w=this;if(V.can("create_canvas")){var u=w.getAsCanvas();if(u){k.appendChild(u);u=null;w.destroy();p.trigger("embedded");return}}var s=w.getAsDataURL(r,v);if(!s){throw new b.ImageError(b.ImageError.WRONG_FORMAT)}if(V.can("use_data_uri_of",s.length)){k.innerHTML='<img src="'+s+'" width="'+w.width+'" height="'+w.height+'" />';w.destroy();p.trigger("embedded")}else{var t=new R();t.bind("TransportingComplete",function(){q=p.connectRuntime(this.result.ruid);p.bind("Embedded",function(){U.extend(q.getShimContainer().style,{top:"0px",left:"0px",width:w.width+"px",height:w.height+"px"});q=null},999);q.exec.call(p,"ImageView","display",this.result.uid,width,height);w.destroy()});t.transport(X.atob(s.substring(s.indexOf("base64,")+7)),r,{required_caps:{display_media:true},runtime_order:"flash,silverlight",container:k})}}try{if(!(k=d.get(k))){throw new b.DOMException(b.DOMException.INVALID_NODE_TYPE_ERR)}if(!this.size){throw new b.DOMException(b.DOMException.INVALID_STATE_ERR)}if(this.width>Y.MAX_RESIZE_WIDTH||this.height>Y.MAX_RESIZE_HEIGHT){}var j=new Y();j.bind("Resize",function(){m.call(this,o.type,o.quality)});j.bind("Load",function(){this.downsize(o)});if(this.meta.thumb&&this.meta.thumb.width>=o.width&&this.meta.thumb.height>=o.height){j.load(this.meta.thumb.data)}else{j.clone(this,false)}return j}catch(l){this.trigger("error",l.code)}},destroy:function(){if(this.ruid){this.getRuntime().exec.call(this,"Image","destroy");this.disconnectRuntime()}if(this.meta&&this.meta.thumb){this.meta.thumb.data.destroy()}this.unbindAll()}});this.handleEventProps(Q);this.bind("Load Resize",function(){return i.call(this)},999);function i(k){try{if(!k){k=this.exec("Image","getInfo")}this.size=k.size;this.width=k.width;this.height=k.height;this.type=k.type;this.meta=k.meta;if(this.name===""){this.name=k.name}return true}catch(j){this.trigger("error",j.code);return false}}function e(k){var l=U.typeOf(k);try{if(k instanceof Y){if(!k.size){throw new b.DOMException(b.DOMException.INVALID_STATE_ERR)}f.apply(this,arguments)}else{if(k instanceof Z){if(!~U.inArray(k.type,["image/jpeg","image/png"])){throw new b.ImageError(b.ImageError.WRONG_FORMAT)}g.apply(this,arguments)}else{if(U.inArray(l,["blob","file"])!==-1){e.call(this,new W(null,k),arguments[1])}else{if(l==="string"){if(k.substr(0,5)==="data:"){e.call(this,new Z(null,{data:k}),arguments[1])}else{h.apply(this,arguments)}}else{if(l==="node"&&k.nodeName.toLowerCase()==="img"){e.call(this,k.src,arguments[1])}else{throw new b.DOMException(b.DOMException.TYPE_MISMATCH_ERR)}}}}}}catch(j){this.trigger("error",j.code)}}function f(l,j){var k=this.connectRuntime(l.ruid);this.ruid=k.uid;k.exec.call(this,"Image","loadFromImage",l,(U.typeOf(j)==="undefined"?true:j))}function g(k,l){var j=this;j.name=k.name||"";function m(n){j.ruid=n.uid;n.exec.call(j,"Image","loadFromBlob",k)}if(k.isDetached()){this.bind("RuntimeInit",function(n,o){m(o)});if(l&&typeof(l.required_caps)==="string"){l.required_caps=c.parseCaps(l.required_caps)}this.connectRuntime(U.extend({required_caps:{access_image_binary:true,resize_image:true}},l))}else{m(this.connectRuntime(k.ruid))}}function h(j,k){var m=this,l;l=new a();l.open("get",j);l.responseType="blob";l.onprogress=function(n){m.trigger(n)};l.onload=function(){g.call(m,l.response,true)};l.onerror=function(n){m.trigger(n)};l.onloadend=function(){l.destroy()};l.bind("RuntimeError",function(n,o){m.trigger("RuntimeError",o)});l.send(null,k)}}Y.MAX_RESIZE_WIDTH=8192;Y.MAX_RESIZE_HEIGHT=8192;Y.prototype=T.instance;return Y});I("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(V,S,R,Q){var P="html5",T={};function U(Z){var X=this,a=R.capTest,W=R.capTrue;var Y=V.extend({access_binary:a(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return X.can("access_binary")&&!!T.Image},display_media:a((Q.can("create_canvas")||Q.can("use_data_uri_over32kb"))&&N("moxie/image/Image")),do_cors:a(window.XMLHttpRequest&&"withCredentials" in new XMLHttpRequest()),drag_and_drop:a(function(){var b=document.createElement("div");return(("draggable" in b)||("ondragstart" in b&&"ondrop" in b))&&(Q.browser!=="IE"||Q.verComp(Q.version,9,">"))}()),filter_by_extension:a(function(){return !((Q.browser==="Chrome"&&Q.verComp(Q.version,28,"<"))||(Q.browser==="IE"&&Q.verComp(Q.version,10,"<"))||(Q.browser==="Safari"&&Q.verComp(Q.version,7,"<"))||(Q.browser==="Firefox"&&Q.verComp(Q.version,37,"<")))}()),return_response_headers:W,return_response_type:function(b){if(b==="json"&&!!window.JSON){return true}return Q.can("return_response_type",b)},return_status_code:W,report_upload_progress:a(window.XMLHttpRequest&&new XMLHttpRequest().upload),resize_image:function(){return X.can("access_binary")&&Q.can("create_canvas")},select_file:function(){return Q.can("use_fileinput")&&window.File},select_folder:function(){return X.can("select_file")&&(Q.browser==="Chrome"&&Q.verComp(Q.version,21,">=")||Q.browser==="Firefox"&&Q.verComp(Q.version,42,">="))},select_multiple:function(){return X.can("select_file")&&!(Q.browser==="Safari"&&Q.os==="Windows")&&!(Q.os==="iOS"&&Q.verComp(Q.osVersion,"7.0.0",">")&&Q.verComp(Q.osVersion,"8.0.0","<"))},send_binary_string:a(window.XMLHttpRequest&&(new XMLHttpRequest().sendAsBinary||(window.Uint8Array&&window.ArrayBuffer))),send_custom_headers:a(window.XMLHttpRequest),send_multipart:function(){return !!(window.XMLHttpRequest&&new XMLHttpRequest().upload&&window.FormData)||X.can("send_binary_string")},slice_blob:a(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return X.can("slice_blob")&&X.can("send_multipart")},summon_file_dialog:function(){return X.can("select_file")&&((Q.browser==="Firefox"&&Q.verComp(Q.version,4,">="))||(Q.browser==="Opera"&&Q.verComp(Q.version,12,">="))||(Q.browser==="IE"&&Q.verComp(Q.version,10,">="))||!!~V.inArray(Q.browser,["Chrome","Safari","Edge"]))},upload_filesize:W,use_http_method:W},arguments[2]);R.call(this,Z,(arguments[1]||P),Y);V.extend(this,{init:function(){this.trigger("Init")},destroy:(function(b){return function(){b.call(X);b=X=null}}(this.destroy))});V.extend(this.getShim(),T)}R.addConstructor(P,U);return T});I("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(R,P){function Q(){function S(V,X,W){var U;if(window.File.prototype.slice){try{V.slice();return V.slice(X,W)}catch(T){return V.slice(X,W-X)}}else{if((U=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)){return U.call(V,X,W)}else{return null}}}this.slice=function(){return new P(this.getRuntime().uid,S.apply(this,arguments))}}return(R.Blob=Q)});I("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(Q){var U={},S="moxie_"+Q.guid();function R(){this.returnValue=false}function W(){this.cancelBubble=true}var V=function(Z,b,X,Y){var a,c;b=b.toLowerCase();if(Z.addEventListener){a=X;Z.addEventListener(b,a,false)}else{if(Z.attachEvent){a=function(){var d=window.event;if(!d.target){d.target=d.srcElement}d.preventDefault=R;d.stopPropagation=W;X(d)};Z.attachEvent("on"+b,a)}}if(!Z[S]){Z[S]=Q.guid()}if(!U.hasOwnProperty(Z[S])){U[Z[S]]={}}c=U[Z[S]];if(!c.hasOwnProperty(b)){c[b]=[]}c[b].push({func:a,orig:X,key:Y})};var T=function(Z,b,X){var d,c;b=b.toLowerCase();if(Z[S]&&U[Z[S]]&&U[Z[S]][b]){d=U[Z[S]][b]}else{return}for(var Y=d.length-1;Y>=0;Y--){if(d[Y].orig===X||d[Y].key===X){if(Z.removeEventListener){Z.removeEventListener(b,d[Y].func,false)}else{if(Z.detachEvent){Z.detachEvent("on"+b,d[Y].func)}}d[Y].orig=null;d[Y].func=null;d.splice(Y,1);if(X!==c){break}}}if(!d.length){delete U[Z[S]][b]}if(Q.isEmptyObj(U[Z[S]])){delete U[Z[S]];try{delete Z[S]}catch(a){Z[S]=c}}};var P=function(Y,X){if(!Y||!Y[S]){return}Q.each(U[Y[S]],function(a,Z){T(Y,Z,X)})};return{addEvent:V,removeEvent:T,removeAllEvents:P}});I("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(T,S,Q,W,V,U,R){function P(){var X,Y;Q.extend(this,{init:function(b){var f=this,Z=f.getRuntime(),i,g,e,d,h,c;X=b;e=X.accept.mimes||U.extList2mimes(X.accept,Z.can("filter_by_extension"));g=Z.getShimContainer();g.innerHTML='<input id="'+Z.uid+'" type="file" style="font-size:999px;opacity:0;"'+(X.multiple&&Z.can("select_multiple")?"multiple":"")+(X.directory&&Z.can("select_folder")?"webkitdirectory directory":"")+(e?' accept="'+e.join(",")+'"':"")+" />";i=W.get(Z.uid);Q.extend(i.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});d=W.get(X.browse_button);Y=W.getStyle(d,"z-index")||"auto";if(Z.can("summon_file_dialog")){if(W.getStyle(d,"position")==="static"){d.style.position="relative"}V.addEvent(d,"click",function(j){var k=W.get(Z.uid);if(k&&!k.disabled){k.click()}j.preventDefault()},f.uid);f.bind("Refresh",function(){h=parseInt(Y,10)||1;W.get(X.browse_button).style.zIndex=h;this.getRuntime().getShimContainer().style.zIndex=h-1})}c=Z.can("summon_file_dialog")?d:g;V.addEvent(c,"mouseover",function(){f.trigger("mouseenter")},f.uid);V.addEvent(c,"mouseout",function(){f.trigger("mouseleave")},f.uid);V.addEvent(c,"mousedown",function(){f.trigger("mousedown")},f.uid);V.addEvent(W.get(X.container),"mouseup",function(){f.trigger("mouseup")},f.uid);i.onchange=function a(j){f.files=[];Q.each(this.files,function(m){var l="";if(X.directory){if(m.name=="."){return true}}if(m.webkitRelativePath){l="/"+m.webkitRelativePath.replace(/^\//,"")}m=new S(Z.uid,m);m.relativePath=l;f.files.push(m)});if(R.browser!=="IE"&&R.browser!=="IEMobile"){this.value=""}else{var k=this.cloneNode(true);this.parentNode.replaceChild(k,this);k.onchange=a}if(f.files.length){f.trigger("change")}};f.trigger({type:"ready",async:true});g=null},setOption:function(b,d){var Z=this.getRuntime();var c=W.get(Z.uid);switch(b){case"accept":if(d){var a=d.mimes||U.extList2mimes(d,Z.can("filter_by_extension"));c.setAttribute("accept",a.join(","))}else{c.removeAttribute("accept")}break;case"directory":if(d&&Z.can("select_folder")){c.setAttribute("directory","");c.setAttribute("webkitdirectory","")}else{c.removeAttribute("directory");c.removeAttribute("webkitdirectory")}break;case"multiple":if(d&&Z.can("select_multiple")){c.setAttribute("multiple","")}else{c.removeAttribute("multiple")}}},disable:function(b){var Z=this.getRuntime(),a;if((a=W.get(Z.uid))){a.disabled=!!b}},destroy:function(){var a=this.getRuntime(),c=a.getShim(),Z=a.getShimContainer(),b=X&&W.get(X.container),d=X&&W.get(X.browse_button);if(b){V.removeAllEvents(b,this.uid)}if(d){V.removeAllEvents(d,this.uid);d.style.zIndex=Y}if(Z){V.removeAllEvents(Z,this.uid);Z.innerHTML=""}c.removeInstance(this.uid);X=Z=b=d=c=null}})}return(T.FileInput=P)});I("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(S,V,U,R,P,T){function Q(){var e=[],a=[],b,X;U.extend(this,{init:function(j){var k=this,i;b=j;X=k.ruid;a=Z(b.accept);i=b.container;P.addEvent(i,"dragover",function(l){if(!h(l)){return}l.preventDefault();l.dataTransfer.dropEffect="copy"},k.uid);P.addEvent(i,"drop",function(l){if(!h(l)){return}l.preventDefault();e=[];if(l.dataTransfer.items&&l.dataTransfer.items[0].webkitGetAsEntry){f(l.dataTransfer.items,function(){k.files=e;k.trigger("drop")})}else{U.each(l.dataTransfer.files,function(m){Y(m)});k.files=e;k.trigger("drop")}},k.uid);P.addEvent(i,"dragenter",function(l){k.trigger("dragenter")},k.uid);P.addEvent(i,"dragleave",function(l){k.trigger("dragleave")},k.uid)},destroy:function(){P.removeAllEvents(b&&R.get(b.container),this.uid);X=e=a=b=null}});function h(i){if(!i.dataTransfer||!i.dataTransfer.types){return false}var j=U.toArray(i.dataTransfer.types||[]);return U.inArray("Files",j)!==-1||U.inArray("public.file-url",j)!==-1||U.inArray("application/x-moz-file",j)!==-1}function Y(k,j){if(c(k)){var i=new V(X,k);i.relativePath=j||"";e.push(i)}}function Z(k){var l=[];for(var j=0;j<k.length;j++){[].push.apply(l,k[j].extensions.split(/\s*,\s*/))}return U.inArray("*",l)===-1?l:[]}function c(j){if(!a.length){return true}var i=T.getFileExtension(j.name);return !i||U.inArray(i,a)!==-1}function f(k,i){var j=[];U.each(k,function(m){var l=m.webkitGetAsEntry();if(l){if(l.isFile){Y(m.getAsFile(),l.fullPath)}else{j.push(l)}}});if(j.length){W(j,i)}else{i()}}function W(j,i){var k=[];U.each(j,function(l){k.push(function(m){g(l,m)})});U.inSeries(k,function(){i()})}function g(j,i){if(j.isFile){j.file(function(k){Y(k,j.fullPath);i()},function(){i()})}else{if(j.isDirectory){d(j,i)}else{i()}}}function d(m,i){var l=[],j=m.createReader();function k(n){j.readEntries(function(o){if(o.length){[].push.apply(l,o);k(n)}else{n()}},n)}k(function(){W(l,i)})}}return(S.FileDrop=Q)});I("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(Q,P,S){function R(){var U,T=false;S.extend(this,{read:function(X,W){var Y=this;Y.result="";U=new window.FileReader();U.addEventListener("progress",function(Z){Y.trigger(Z)});U.addEventListener("load",function(Z){Y.result=T?V(U.result):U.result;Y.trigger(Z)});U.addEventListener("error",function(Z){Y.trigger(Z,U.error)});U.addEventListener("loadend",function(Z){U=null;Y.trigger(Z)});if(S.typeOf(U[X])==="function"){T=false;U[X](W.getSource())}else{if(X==="readAsBinaryString"){T=true;U.readAsDataURL(W.getSource())}}},abort:function(){if(U){U.abort()}},destroy:function(){U=null}});function V(W){return P.atob(W.substring(W.indexOf("base64,")+7))}}return(Q.FileReader=R)});I("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env"],function(S,P,U,T,R,W,X,Y,Q){function V(){var b=this,d,e;P.extend(this,{send:function(j,i){var m=this,h=(Q.browser==="Mozilla"&&Q.verComp(Q.version,4,">=")&&Q.verComp(Q.version,7,"<")),n=Q.browser==="Android Browser",k=false;e=j.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase();d=c();d.open(j.method,j.url,j.async,j.user,j.password);if(i instanceof W){if(i.isDetached()){k=true}i=i.getSource()}else{if(i instanceof X){if(i.hasBlob()){if(i.getBlob().isDetached()){i=a.call(m,i);k=true}else{if((h||n)&&P.typeOf(i.getBlob().getSource())==="blob"&&window.FileReader){f.call(m,j,i);return}}}if(i instanceof X){var g=new window.FormData();i.each(function(p,o){if(p instanceof W){g.append(o,p.getSource())}else{g.append(o,p)}});i=g}}}if(d.upload){if(j.withCredentials){d.withCredentials=true}d.addEventListener("load",function(o){m.trigger(o)});d.addEventListener("error",function(o){m.trigger(o)});d.addEventListener("progress",function(o){m.trigger(o)});d.upload.addEventListener("progress",function(o){m.trigger({type:"UploadProgress",loaded:o.loaded,total:o.total})})}else{d.onreadystatechange=function l(){switch(d.readyState){case 1:break;case 2:break;case 3:var o,q;try{if(T.hasSameOrigin(j.url)){o=d.getResponseHeader("Content-Length")||0}if(d.responseText){q=d.responseText.length}}catch(p){o=q=0}m.trigger({type:"progress",lengthComputable:!!o,total:parseInt(o,10),loaded:q});break;case 4:d.onreadystatechange=function(){};if(d.status===0){m.trigger("error")}else{m.trigger("load")}break}}}if(!P.isEmptyObj(j.headers)){P.each(j.headers,function(p,o){d.setRequestHeader(o,p)})}if(""!==j.responseType&&"responseType" in d){if("json"===j.responseType&&!Q.can("return_response_type","json")){d.responseType="text"}else{d.responseType=j.responseType}}if(!k){d.send(i)}else{if(d.sendAsBinary){d.sendAsBinary(i)}else{(function(){var p=new Uint8Array(i.length);for(var o=0;o<i.length;o++){p[o]=(i.charCodeAt(o)&255)}d.send(p.buffer)}())}}m.trigger("loadstart")},getStatus:function(){try{if(d){return d.status}}catch(g){}return 0},getResponse:function(i){var g=this.getRuntime();try{switch(i){case"blob":var l=new R(g.uid,d.response);var k=d.getResponseHeader("Content-Disposition");if(k){var h=k.match(/filename=([\'\"'])([^\1]+)\1/);if(h){e=h[2]}}l.name=e;if(!l.type){l.type=U.getFileMime(e)}return l;case"json":if(!Q.can("return_response_type","json")){return d.status===200&&!!window.JSON?JSON.parse(d.responseText):null}return d.response;case"document":return Z(d);default:return d.responseText!==""?d.responseText:null}}catch(j){return null}},getAllResponseHeaders:function(){try{return d.getAllResponseHeaders()}catch(g){}return""},abort:function(){if(d){d.abort()}},destroy:function(){b=e=null}});function f(h,k){var j=this,g,i;g=k.getBlob().getSource();i=new window.FileReader();i.onload=function(){k.append(k.getBlobName(),new W(null,{type:g.type,data:i.result}));b.send.call(j,h,k)};i.readAsBinaryString(g)}function c(){if(window.XMLHttpRequest&&!(Q.browser==="IE"&&Q.verComp(Q.version,8,"<"))){return new window.XMLHttpRequest()}else{return(function(){var h=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"];for(var g=0;g<h.length;g++){try{return new ActiveXObject(h[g])}catch(j){}}})()}}function Z(h){var g=h.responseXML;var i=h.responseText;if(Q.browser==="IE"&&i&&g&&!g.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(h.getResponseHeader("Content-Type"))){g=new window.ActiveXObject("Microsoft.XMLDOM");g.async=false;g.validateOnParse=false;g.loadXML(i)}if(g){if((Q.browser==="IE"&&g.parseError!==0)||!g.documentElement||g.documentElement.tagName==="parsererror"){return null}}return g}function a(l){var i="----moxieboundary"+new Date().getTime(),k="--",j="\r\n",h="",g=this.getRuntime();if(!g.can("send_binary_string")){throw new Y.RuntimeError(Y.RuntimeError.NOT_SUPPORTED_ERR)}d.setRequestHeader("Content-Type","multipart/form-data; boundary="+i);l.each(function(n,m){if(n instanceof W){h+=k+i+j+'Content-Disposition: form-data; name="'+m+'"; filename="'+unescape(encodeURIComponent(n.name||"blob"))+'"'+j+"Content-Type: "+(n.type||"application/octet-stream")+j+j+n.getSource()+j}else{h+=k+i+j+'Content-Disposition: form-data; name="'+m+'"'+j+j+unescape(encodeURIComponent(n))+j}});h+=k+i+k+j;return h}}return(S.XMLHttpRequest=V)});I("moxie/runtime/html5/utils/BinaryReader",["moxie/core/utils/Basic"],function(S){function Q(T){if(T instanceof ArrayBuffer){P.apply(this,arguments)}else{R.apply(this,arguments)}}S.extend(Q.prototype,{littleEndian:false,read:function(W,T){var X,U,V;if(W+T>this.length()){throw new Error("You are trying to read outside the source boundaries.")}U=this.littleEndian?0:-8*(T-1);for(V=0,X=0;V<T;V++){X|=(this.readByteAt(W+V)<<Math.abs(U+V*8))}return X},write:function(X,W,T){var U,V,Y="";if(X>this.length()){throw new Error("You are trying to write outside the source boundaries.")}U=this.littleEndian?0:-8*(T-1);for(V=0;V<T;V++){this.writeByteAt(X+V,(W>>Math.abs(U+V*8))&255)}},BYTE:function(T){return this.read(T,1)},SHORT:function(T){return this.read(T,2)},LONG:function(T){return this.read(T,4)},SLONG:function(U){var T=this.read(U,4);return(T>2147483647?T-4294967296:T)},CHAR:function(T){return String.fromCharCode(this.read(T,1))},STRING:function(U,T){return this.asArray("CHAR",U,T).join("")},asArray:function(T,W,V){var X=[];for(var U=0;U<V;U++){X[U]=this[T](W+U)}return X}});function P(U){var T=new DataView(U);S.extend(this,{readByteAt:function(V){return T.getUint8(V)},writeByteAt:function(W,V){T.setUint8(W,V)},SEGMENT:function(Y,V,W){switch(arguments.length){case 2:return U.slice(Y,Y+V);case 1:return U.slice(Y);case 3:if(W===null){W=new ArrayBuffer()}if(W instanceof ArrayBuffer){var X=new Uint8Array(this.length()-V+W.byteLength);if(Y>0){X.set(new Uint8Array(U.slice(0,Y)),0)}X.set(new Uint8Array(W),Y);X.set(new Uint8Array(U.slice(Y+V)),Y+W.byteLength);this.clear();U=X.buffer;T=new DataView(U);break}default:return U}},length:function(){return U?U.byteLength:0},clear:function(){T=U=null}})}function R(U){S.extend(this,{readByteAt:function(V){return U.charCodeAt(V)},writeByteAt:function(W,V){T(String.fromCharCode(V),W,1)},SEGMENT:function(X,V,W){switch(arguments.length){case 1:return U.substr(X);case 2:return U.substr(X,V);case 3:T(W!==null?W:"",X,V);break;default:return U}},length:function(){return U?U.length:0},clear:function(){U=null}});function T(W,X,V){V=arguments.length===3?V:U.length-X-1;U=U.substr(0,X)+W+U.substr(V+X)}}return Q});I("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(P,Q){return function R(X){var S=[],W,V,U,T=0;W=new P(X);if(W.SHORT(0)!==65496){W.clear();throw new Q.ImageError(Q.ImageError.WRONG_FORMAT)}V=2;while(V<=W.length()){U=W.SHORT(V);if(U>=65488&&U<=65495){V+=2;continue}if(U===65498||U===65497){break}T=W.SHORT(V+2)+2;if(U>=65505&&U<=65519){S.push({hex:U,name:"APP"+(U&15),start:V,length:T,segment:W.SEGMENT(V,T)})}V+=T}W.clear();return{headers:S,restore:function(b){var a,Y,Z;Z=new P(b);V=Z.SHORT(2)==65504?4+Z.SHORT(4):2;for(Y=0,a=S.length;Y<a;Y++){Z.SEGMENT(V,0,S[Y].segment);V+=S[Y].length}b=Z.SEGMENT();Z.clear();return b},strip:function(c){var a,Y,b,Z;b=new R(c);Y=b.headers;b.purge();a=new P(c);Z=Y.length;while(Z--){a.SEGMENT(Y[Z].start,Y[Z].length,"")}c=a.SEGMENT();a.clear();return c},get:function(a){var Y=[];for(var Z=0,b=S.length;Z<b;Z++){if(S[Z].name===a.toUpperCase()){Y.push(S[Z].segment)}}return Y},set:function(b,c){var Y=[],Z,a,d;if(typeof(c)==="string"){Y.push(c)}else{Y=c}for(Z=a=0,d=S.length;Z<d;Z++){if(S[Z].name===b.toUpperCase()){S[Z].segment=Y[a];S[Z].length=Y[a].length;a++}if(a>=Y.length){break}}},purge:function(){this.headers=S=[]}}}});I("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(S,Q,R){function P(W){var Y,c,U,Z,X,V;Q.call(this,W);c={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}};U={"ColorSpace":{1:"sRGB",0:"Uncalibrated"},"MeteringMode":{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},"LightSource":{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},"Flash":{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},"ExposureMode":{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},"WhiteBalance":{0:"Auto white balance",1:"Manual white balance"},"SceneCaptureType":{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},"Contrast":{0:"Normal",1:"Soft",2:"Hard"},"Saturation":{0:"Normal",1:"Low saturation",2:"High saturation"},"Sharpness":{0:"Normal",1:"Soft",2:"Hard"},"GPSLatitudeRef":{N:"North latitude",S:"South latitude"},"GPSLongitudeRef":{E:"East longitude",W:"West longitude"}};Z={tiffHeader:10};X=Z.tiffHeader;Y={clear:this.clear};S.extend(this,{read:function(){try{return P.prototype.read.apply(this,arguments)}catch(d){throw new R.ImageError(R.ImageError.INVALID_META_ERR)}},write:function(){try{return P.prototype.write.apply(this,arguments)}catch(d){throw new R.ImageError(R.ImageError.INVALID_META_ERR)}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(d){return this.LONG(d)/this.LONG(d+4)},SRATIONAL:function(d){return this.SLONG(d)/this.SLONG(d+4)},ASCII:function(d){return this.CHAR(d)},TIFF:function(){return V||null},EXIF:function(){var g=null;if(Z.exifIFD){try{g=a.call(this,Z.exifIFD,c.exif)}catch(f){return null}if(g.ExifVersion&&S.typeOf(g.ExifVersion)==="array"){for(var d=0,e="";d<g.ExifVersion.length;d++){e+=String.fromCharCode(g.ExifVersion[d])}g.ExifVersion=e}}return g},GPS:function(){var d=null;if(Z.gpsIFD){try{d=a.call(this,Z.gpsIFD,c.gps)}catch(e){return null}if(d.GPSVersionID&&S.typeOf(d.GPSVersionID)==="array"){d.GPSVersionID=d.GPSVersionID.join(".")}}return d},thumb:function(){if(Z.IFD1){try{var e=a.call(this,Z.IFD1,c.thumb);if("JPEGInterchangeFormat" in e){return this.SEGMENT(Z.tiffHeader+e.JPEGInterchangeFormat,e.JPEGInterchangeFormatLength)}}catch(d){}}return null},setExif:function(d,e){if(d!=="PixelXDimension"&&d!=="PixelYDimension"){return false}return T.call(this,"exif",d,e)},clear:function(){Y.clear();W=c=U=V=Z=Y=null}});if(this.SHORT(0)!==65505||this.STRING(4,5).toUpperCase()!=="EXIF\0"){throw new R.ImageError(R.ImageError.INVALID_META_ERR)}this.littleEndian=(this.SHORT(X)==18761);if(this.SHORT(X+=2)!==42){throw new R.ImageError(R.ImageError.INVALID_META_ERR)}Z.IFD0=Z.tiffHeader+this.LONG(X+=2);V=a.call(this,Z.IFD0,c.tiff);if("ExifIFDPointer" in V){Z.exifIFD=Z.tiffHeader+V.ExifIFDPointer;delete V.ExifIFDPointer}if("GPSInfoIFDPointer" in V){Z.gpsIFD=Z.tiffHeader+V.GPSInfoIFDPointer;delete V.GPSInfoIFDPointer}if(S.isEmptyObj(V)){V=null}var b=this.LONG(Z.IFD0+this.SHORT(Z.IFD0)*12+2);if(b){Z.IFD1=Z.tiffHeader+b}function a(h,j){var g=this;var l,n,q,s,f,m,e,d,r=[],o={};var p={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"};var k={"BYTE":1,"UNDEFINED":1,"ASCII":1,"SHORT":2,"LONG":4,"RATIONAL":8,"SLONG":4,"SRATIONAL":8};l=g.SHORT(h);for(n=0;n<l;n++){r=[];e=h+2+n*12;q=j[g.SHORT(e)];if(q===H){continue}s=p[g.SHORT(e+=2)];f=g.LONG(e+=2);m=k[s];if(!m){throw new R.ImageError(R.ImageError.INVALID_META_ERR)}e+=4;if(m*f>4){e=g.LONG(e)+Z.tiffHeader}if(e+m*f>=this.length()){throw new R.ImageError(R.ImageError.INVALID_META_ERR)}if(s==="ASCII"){o[q]=S.trim(g.STRING(e,f).replace(/\0$/,""));continue}else{r=g.asArray(s,e,f);d=(f==1?r[0]:r);if(U.hasOwnProperty(q)&&typeof d!="object"){o[q]=U[q][d]}else{o[q]=d}}}return o}function T(n,f,h){var e,g,k,d=0;if(typeof(f)==="string"){var o=c[n.toLowerCase()];for(var l in o){if(o[l]===f){f=l;break}}}e=Z[n.toLowerCase()+"IFD"];g=this.SHORT(e);for(var j=0;j<g;j++){k=e+12*j+2;if(this.SHORT(k)==f){d=k+8;break}}if(!d){return false}try{this.write(d,h,4)}catch(m){return false}return true}}P.prototype=Q.prototype;return P});I("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(U,S,T,R,P){function Q(W){var d,Z,Y,c;d=new R(W);if(d.SHORT(0)!==65496){throw new S.ImageError(S.ImageError.WRONG_FORMAT)}Z=new T(W);try{Y=new P(Z.get("app1")[0])}catch(b){}c=a.call(this);U.extend(this,{type:"image/jpeg",size:d.length(),width:c&&c.width||0,height:c&&c.height||0,setExif:function(e,f){if(!Y){return false}if(U.typeOf(e)==="object"){U.each(e,function(h,g){Y.setExif(g,h)})}else{Y.setExif(e,f)}Z.set("app1",Y.SEGMENT())},writeHeaders:function(){if(!arguments.length){return Z.restore(W)}return Z.restore(arguments[0])},stripHeaders:function(e){return Z.strip(e)},purge:function(){X.call(this)}});if(Y){this.meta={tiff:Y.TIFF(),exif:Y.EXIF(),gps:Y.GPS(),thumb:V()}}function a(f){var h=0,g,e;if(!f){f=d}while(h<=f.length()){g=f.SHORT(h+=2);if(g>=65472&&g<=65475){h+=5;return{height:f.SHORT(h),width:f.SHORT(h+=2)}}e=f.SHORT(h+=2);h+=e-2}return null}function V(){var g=Y.thumb(),e,f;if(g){e=new R(g);f=a(e);e.clear();if(f){f.data=g;return f}}return null}function X(){if(!Y||!Z||!d){return}Y.clear();Z.purge();d.clear();c=Z=Y=d=null}}return Q});I("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(R,S,Q){function P(T){var a,W,U,Z;a=new Q(T);(function(){var d=0,b=0,c=[35152,20039,3338,6666];for(b=0;b<c.length;b++,d+=2){if(c[b]!=a.SHORT(d)){throw new R.ImageError(R.ImageError.WRONG_FORMAT)}}}());function X(){var b,c;b=V.call(this,8);if(b.type=="IHDR"){c=b.start;return{width:a.LONG(c),height:a.LONG(c+=4)}}return null}function Y(){if(!a){return}a.clear();T=Z=W=U=a=null}Z=X.call(this);S.extend(this,{type:"image/png",size:a.length(),width:Z.width,height:Z.height,purge:function(){Y.call(this)}});Y.call(this);function V(e){var c,b,f,d;c=a.LONG(e);b=a.STRING(e+=4,4);f=e+=4;d=a.LONG(e+c);return{length:c,type:b,start:f,CRC:d}}}return P});I("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(S,R,Q,P){return function(V){var U=[Q,P],T;T=(function(){for(var W=0;W<U.length;W++){try{return new U[W](V)}catch(X){}}throw new R.ImageError(R.ImageError.WRONG_FORMAT)}());S.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(W){return W},stripHeaders:function(W){return W},purge:function(){V=null}});S.extend(this,T);this.purge=function(){T.purge();T=null}}});I("moxie/runtime/html5/image/ResizerCanvas",[],function(){function Q(U,T){var W=U.width;var V=Math.floor(W*T);var R=false;if(T<0.5||T>2){T=T<0.5?0.5:2;R=true}var S=P(U,T);if(R){return Q(S,V/S.width)}else{return S}}function P(T,S){var V=T.width;var X=T.height;var U=Math.floor(V*S);var W=Math.floor(X*S);var R=document.createElement("canvas");R.width=U;R.height=W;R.getContext("2d").drawImage(T,0,0,V,X,0,0,U,W);T=null;return R}return{scale:Q}});I("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/Blob","moxie/file/File","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/ResizerCanvas","moxie/core/utils/Mime","moxie/core/utils/Env"],function(X,Q,Y,T,W,S,V,R,Z,P){function U(){var k=this,g,h,n,m,o,l=false,j=true;Q.extend(this,{loadFromBlob:function(r){var q=this.getRuntime(),s=arguments.length>1?arguments[1]:true;if(!q.can("access_binary")){throw new Y.RuntimeError(Y.RuntimeError.NOT_SUPPORTED_ERR)}o=r;if(r.isDetached()){m=r.getSource();b.call(this,m);return}else{f.call(this,r.getSource(),function(t){if(s){m=p(t)}b.call(this,t)})}},loadFromImage:function(r,q){this.meta=r.meta;o=new S(null,{name:r.name,size:r.size,type:r.type});b.call(this,q?(m=r.getAsBinaryString()):r.getAsDataURL())},getInfo:function(){var q=this.getRuntime(),r;if(!h&&m&&q.can("access_image_binary")){h=new V(m)}r={width:i().width||0,height:i().height||0,type:o.type||Z.getFileMime(o.name),size:m&&m.length||o.size||0,name:o.name||"",meta:null};if(j){r.meta=h&&h.meta||this.meta||{};if(r.meta&&r.meta.thumb&&!(r.meta.thumb.data instanceof W)){r.meta.thumb.data=new W(null,{type:"image/jpeg",data:r.meta.thumb.data})}}return r},resize:function(s,r,t){var q=document.createElement("canvas");q.width=s.width;q.height=s.height;q.getContext("2d").drawImage(i(),s.x,s.y,s.width,s.height,0,0,q.width,q.height);n=R.scale(q,r);j=t.preserveHeaders;if(!j){var u=(this.meta&&this.meta.tiff&&this.meta.tiff.Orientation)||1;n=d(n,u)}this.width=n.width;this.height=n.height;l=true;this.trigger("Resize")},getAsCanvas:function(){if(!n){n=e()}n.id=this.uid+"_canvas";return n},getAsBlob:function(q,r){if(q!==this.type){l=true;return new S(null,{name:o.name||"",type:q,data:k.getAsDataURL(q,r)})}return new S(null,{name:o.name||"",type:q,data:k.getAsBinaryString(q,r)})},getAsDataURL:function(q){var s=arguments[1]||90;if(!l){return g.src}e();if("image/jpeg"!==q){return n.toDataURL("image/png")}else{try{return n.toDataURL("image/jpeg",s/100)}catch(r){return n.toDataURL("image/jpeg")}}},getAsBinaryString:function(q,t){if(!l){if(!m){m=p(k.getAsDataURL(q,t))}return m}if("image/jpeg"!==q){m=p(k.getAsDataURL(q,t))}else{var r;if(!t){t=90}e();try{r=n.toDataURL("image/jpeg",t/100)}catch(s){r=n.toDataURL("image/jpeg")}m=p(r);if(h){m=h.stripHeaders(m);if(j){if(h.meta&&h.meta.exif){h.setExif({PixelXDimension:this.width,PixelYDimension:this.height})}m=h.writeHeaders(m)}h.purge();h=null}}l=false;return m},destroy:function(){k=null;c.call(this);this.getRuntime().getShim().removeInstance(this.uid)}});function i(){if(!n&&!g){throw new Y.ImageError(Y.DOMException.INVALID_STATE_ERR)}return n||g}function e(){var q=i();if(q.nodeName.toLowerCase()=="canvas"){return q}n=document.createElement("canvas");n.width=q.width;n.height=q.height;n.getContext("2d").drawImage(q,0,0);return n}function p(q){return T.atob(q.substring(q.indexOf("base64,")+7))}function a(r,q){return"data:"+(q||"")+";base64,"+T.btoa(r)}function b(q){var r=this;g=new Image();g.onerror=function(){c.call(this);r.trigger("error",Y.ImageError.WRONG_FORMAT)};g.onload=function(){r.trigger("load")};g.src=q.substr(0,5)=="data:"?q:a(q,o.type)}function f(s,q){var t=this,r;if(window.FileReader){r=new FileReader();r.onload=function(){q.call(t,this.result)};r.onerror=function(){t.trigger("error",Y.ImageError.WRONG_FORMAT)};r.readAsDataURL(s)}else{return q.call(this,s.getAsDataURL())}}function d(w,q){var t=Math.PI/180;var u=document.createElement("canvas");var v=u.getContext("2d");var s=w.width;var r=w.height;if(Q.inArray(q,[5,6,7,8])>-1){u.width=r;u.height=s}else{u.width=s;u.height=r}switch(q){case 2:v.translate(s,0);v.scale(-1,1);break;case 3:v.translate(s,r);v.rotate(180*t);break;case 4:v.translate(0,r);v.scale(1,-1);break;case 5:v.rotate(90*t);v.scale(1,-1);break;case 6:v.rotate(90*t);v.translate(0,-r);break;case 7:v.rotate(90*t);v.translate(s,-r);v.scale(-1,1);break;case 8:v.rotate(-90*t);v.translate(-s,0);break}v.drawImage(w,0,0,s,r);return u}function c(){if(h){h.purge();h=null}m=g=n=o=null;l=false}}return(X.Image=U)});I("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(Q,R,Z,W,Y){var X="flash",U={};function S(){var c;try{c=navigator.plugins["Shockwave Flash"];c=c.description}catch(a){try{c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(b){c="0.0"}}c=c.match(/\d+/g);return parseFloat(c[0]+"."+c[1])}function V(c){var a=Z.get(c);if(a&&a.nodeName=="OBJECT"){if(R.browser==="IE"){a.style.display="none";(function b(){if(a.readyState==4){T(c)}else{setTimeout(b,10)}})()}else{a.parentNode.removeChild(a)}}}function T(c){var b=Z.get(c);if(b){for(var a in b){if(typeof b[a]=="function"){b[a]=null}}b.parentNode.removeChild(b)}}function P(c){var b=this,a;c=Q.extend({swf_url:R.swf_url},c);Y.call(this,c,X,{access_binary:function(d){return d&&b.mode==="browser"},access_image_binary:function(d){return d&&b.mode==="browser"},display_media:Y.capTest(N("moxie/image/Image")),do_cors:Y.capTrue,drag_and_drop:false,report_upload_progress:function(){return b.mode==="client"},resize_image:Y.capTrue,return_response_headers:false,return_response_type:function(d){if(d==="json"&&!!window.JSON){return true}return !Q.arrayDiff(d,["","text","document"])||b.mode==="browser"},return_status_code:function(d){return b.mode==="browser"||!Q.arrayDiff(d,[200,404])},select_file:Y.capTrue,select_multiple:Y.capTrue,send_binary_string:function(d){return d&&b.mode==="browser"},send_browser_cookies:function(d){return d&&b.mode==="browser"},send_custom_headers:function(d){return d&&b.mode==="browser"},send_multipart:Y.capTrue,slice_blob:function(d){return d&&b.mode==="browser"},stream_upload:function(d){return d&&b.mode==="browser"},summon_file_dialog:false,upload_filesize:function(d){return Q.parseSizeStr(d)<=2097152||b.mode==="client"},use_http_method:function(d){return !Q.arrayDiff(d,["GET","POST"])}},{access_binary:function(d){return d?"browser":"client"},access_image_binary:function(d){return d?"browser":"client"},report_upload_progress:function(d){return d?"browser":"client"},return_response_type:function(d){return Q.arrayDiff(d,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(d){return Q.arrayDiff(d,[200,404])?"browser":["client","browser"]},send_binary_string:function(d){return d?"browser":"client"},send_browser_cookies:function(d){return d?"browser":"client"},send_custom_headers:function(d){return d?"browser":"client"},slice_blob:function(d){return d?"browser":"client"},stream_upload:function(d){return d?"client":"browser"},upload_filesize:function(d){return Q.parseSizeStr(d)>=2097152?"client":"browser"}},"client");if(S()<11.3){if(D&&R.debug.runtime){R.log("\tFlash didn't meet minimal version requirement (11.3).")}this.mode=false}Q.extend(this,{getShim:function(){return Z.get(this.uid)},shimExec:function(e,d){var f=[].slice.call(arguments,2);return b.getShim().exec(this.uid,e,d,f)},init:function(){var d,e,f;f=this.getShimContainer();Q.extend(f.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});d='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+c.swf_url+'" ';if(R.browser==="IE"){d+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}d+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+c.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+R.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';if(R.browser==="IE"){e=document.createElement("div");f.appendChild(e);e.outerHTML=d;e=f=null}else{f.innerHTML=d}a=setTimeout(function(){if(b&&!b.initialized){b.trigger("Error",new W.RuntimeError(W.RuntimeError.NOT_INIT_ERR));if(D&&R.debug.runtime){R.log("\tFlash failed to initialize within a specified period of time (typically 5s).")}}},5000)},destroy:(function(d){return function(){V(b.uid);d.call(b);clearTimeout(a);c=a=d=b=null}}(this.destroy))},U)}Y.addConstructor(X,P);return U});I("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(Q,P){var R={slice:function(U,W,V,S){var T=this.getRuntime();if(W<0){W=Math.max(U.size+W,0)}else{if(W>0){W=Math.min(W,U.size)}}if(V<0){V=Math.max(U.size+V,0)}else{if(V>0){V=Math.min(V,U.size)}}U=T.shimExec.call(this,"Blob","slice",W,V,S||"");if(U){U=new P(T.uid,U)}return U}};return(Q.Blob=R)});I("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime","moxie/file/File","moxie/core/utils/Basic"],function(Q,S,R){var P={init:function(U){var V=this,T=this.getRuntime();this.bind("Change",function(){var W=T.shimExec.call(V,"FileInput","getFiles");V.files=[];R.each(W,function(X){V.files.push(new S(T.uid,X))})},999);this.getRuntime().shimExec.call(this,"FileInput","init",{accept:U.accept,multiple:U.multiple});this.trigger("ready")}};return(Q.FileInput=P)});I("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(Q,P){function S(U,T){switch(T){case"readAsText":return P.atob(U,"utf8");case"readAsBinaryString":return P.atob(U);case"readAsDataURL":return U}return null}var R={read:function(U,T){var V=this;V.result="";if(U==="readAsDataURL"){V.result="data:"+(T.type||"")+";base64,"}V.bind("Progress",function(W,X){if(X){V.result+=S(X,U)}},999);return V.getRuntime().shimExec.call(this,"FileReader","readAsBase64",T.uid)}};return(Q.FileReader=R)});I("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(R,P){function S(U,T){switch(T){case"readAsText":return P.atob(U,"utf8");case"readAsBinaryString":return P.atob(U);case"readAsDataURL":return U}return null}var Q={read:function(V,T){var U,W=this.getRuntime();U=W.shimExec.call(this,"FileReaderSync","readAsBase64",T.uid);if(!U){return null}if(V==="readAsDataURL"){U="data:"+(T.type||"")+";base64,"+U}return S(U,V,T.type)}};return(R.FileReaderSync=Q)});I("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(Q,P){var R={getAsBlob:function(S){var T=this.getRuntime(),U=T.shimExec.call(this,"Transporter","getAsBlob",S);if(U){return new P(T.uid,U)}return null}};return(Q.Transporter=R)});I("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/runtime/flash/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter","moxie/runtime/flash/runtime/Transporter"],function(V,S,X,T,P,U,Y,R,Q){var W={send:function(c,b){var f=this,d=f.getRuntime();function e(){c.transport=d.mode;d.shimExec.call(f,"XMLHttpRequest","send",c,b)}function Z(j,i){d.shimExec.call(f,"XMLHttpRequest","appendBlob",j,i.uid);b=null;e()}function g(j,i){var k=new R();k.bind("TransportingComplete",function(){i(this.result)});k.transport(j.getSource(),j.type,{ruid:d.uid})}if(!S.isEmptyObj(c.headers)){S.each(c.headers,function(j,i){d.shimExec.call(f,"XMLHttpRequest","setRequestHeader",i,j.toString())})}if(b instanceof Y){var h;b.each(function(j,i){if(j instanceof X){h=i}else{d.shimExec.call(f,"XMLHttpRequest","append",i,j)}});if(!b.hasBlob()){b=null;e()}else{var a=b.getBlob();if(a.isDetached()){g(a,function(i){a.destroy();Z(h,i)})}else{Z(h,a)}}}else{if(b instanceof X){if(b.isDetached()){g(b,function(i){b.destroy();b=i.uid;e()})}else{b=b.uid;e()}}else{e()}}},getResponse:function(b){var a,Z,c=this.getRuntime();Z=c.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob");if(Z){Z=new T(c.uid,Z);if("blob"===b){return Z}try{a=new P();if(!!~S.inArray(b,["","text"])){return a.readAsText(Z)}else{if("json"===b&&!!window.JSON){return JSON.parse(a.readAsText(Z))}}}finally{Z.destroy()}}return null},abort:function(a){var Z=this.getRuntime();Z.shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}};return(V.XMLHttpRequest=W)});I("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(S,U,T,P,Q){var R={loadFromBlob:function(W){var Z=this,V=Z.getRuntime();function X(a){V.shimExec.call(Z,"Image","loadFromBlob",a.uid);Z=V=null}if(W.isDetached()){var Y=new T();Y.bind("TransportingComplete",function(){X(Y.result.getSource())});Y.transport(W.getSource(),W.type,{ruid:V.uid})}else{X(W.getSource())}},loadFromImage:function(W){var V=this.getRuntime();return V.shimExec.call(this,"Image","loadFromImage",W.uid)},getInfo:function(){var V=this.getRuntime(),W=V.shimExec.call(this,"Image","getInfo");if(W.meta&&W.meta.thumb&&W.meta.thumb.data&&!(V.meta.thumb.data instanceof P)){W.meta.thumb.data=new P(V.uid,W.meta.thumb.data)}return W},getAsBlob:function(V,Y){var W=this.getRuntime(),X=W.shimExec.call(this,"Image","getAsBlob",V,Y);if(X){return new P(W.uid,X)}return null},getAsDataURL:function(){var V=this.getRuntime(),X=V.Image.getAsBlob.apply(this,arguments),W;if(!X){return null}W=new Q();return W.readAsDataURL(X)}};return(S.Image=R)});I("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(Q,R,W,T,V){var U="silverlight",S={};function X(d){var i=false,k=null,c,b,Y,f,Z,a=0;try{try{k=new ActiveXObject("AgControl.AgControl");if(k.IsVersionSupported(d)){i=true}k=null}catch(g){var h=navigator.plugins["Silverlight Plug-In"];if(h){c=h.description;if(c==="1.0.30226.2"){c="2.0.30226.2"}b=c.split(".");while(b.length>3){b.pop()}while(b.length<4){b.push(0)}Y=d.split(".");while(Y.length>4){Y.pop()}do{f=parseInt(Y[a],10);Z=parseInt(b[a],10);a++}while(a<Y.length&&f===Z);if(f<=Z&&!isNaN(f)){i=true}}}}catch(j){i=false}return i}function P(a){var Z=this,Y;a=Q.extend({xap_url:R.xap_url},a);V.call(this,a,U,{access_binary:V.capTrue,access_image_binary:V.capTrue,display_media:V.capTest(N("moxie/image/Image")),do_cors:V.capTrue,drag_and_drop:false,report_upload_progress:V.capTrue,resize_image:V.capTrue,return_response_headers:function(b){return b&&Z.mode==="client"},return_response_type:function(b){if(b!=="json"){return true}else{return !!window.JSON}},return_status_code:function(b){return Z.mode==="client"||!Q.arrayDiff(b,[200,404])},select_file:V.capTrue,select_multiple:V.capTrue,send_binary_string:V.capTrue,send_browser_cookies:function(b){return b&&Z.mode==="browser"},send_custom_headers:function(b){return b&&Z.mode==="client"},send_multipart:V.capTrue,slice_blob:V.capTrue,stream_upload:true,summon_file_dialog:false,upload_filesize:V.capTrue,use_http_method:function(b){return Z.mode==="client"||!Q.arrayDiff(b,["GET","POST"])}},{return_response_headers:function(b){return b?"client":"browser"},return_status_code:function(b){return Q.arrayDiff(b,[200,404])?"client":["client","browser"]},send_browser_cookies:function(b){return b?"browser":"client"},send_custom_headers:function(b){return b?"client":"browser"},use_http_method:function(b){return Q.arrayDiff(b,["GET","POST"])?"client":["client","browser"]}});if(!X("2.0.31005.0")||R.browser==="Opera"){if(D&&R.debug.runtime){R.log("\tSilverlight is not installed or minimal version (2.0.31005.0) requirement not met (not likely).")}this.mode=false}Q.extend(this,{getShim:function(){return W.get(this.uid).content.Moxie},shimExec:function(c,b){var d=[].slice.call(arguments,2);return Z.getShim().exec(this.uid,c,b,d)},init:function(){var b;b=this.getShimContainer();b.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+a.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+R.global_event_dispatcher+'"/></object>';Y=setTimeout(function(){if(Z&&!Z.initialized){Z.trigger("Error",new T.RuntimeError(T.RuntimeError.NOT_INIT_ERR));if(D&&R.debug.runtime){R.log("Silverlight failed to initialize within a specified period of time (5-10s).")}}},R.OS!=="Windows"?10000:5000)},destroy:(function(b){return function(){b.call(Z);clearTimeout(Y);a=Y=b=Z=null}}(this.destroy))},S)}V.addConstructor(U,P);return S});I("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(Q,R,P){return(Q.Blob=R.extend({},P))});I("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime","moxie/file/File","moxie/core/utils/Basic"],function(R,T,S){function Q(W){var V="";for(var U=0;U<W.length;U++){V+=(V!==""?"|":"")+W[U].title+" | *."+W[U].extensions.replace(/,/g,";*.")}return V}var P={init:function(V){var W=this,U=this.getRuntime();this.bind("Change",function(){var X=U.shimExec.call(W,"FileInput","getFiles");W.files=[];S.each(X,function(Y){W.files.push(new T(U.uid,Y))})},999);U.shimExec.call(this,"FileInput","init",Q(V.accept),V.multiple);this.trigger("ready")},setOption:function(U,V){if(U=="accept"){V=Q(V)}this.getRuntime().shimExec.call(this,"FileInput","setOption",U,V)}};return(R.FileInput=P)});I("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(R,Q,S){var P={init:function(){var V=this,T=V.getRuntime(),U;U=T.getShimContainer();S.addEvent(U,"dragover",function(W){W.preventDefault();W.stopPropagation();W.dataTransfer.dropEffect="copy"},V.uid);S.addEvent(U,"dragenter",function(W){W.preventDefault();var X=Q.get(T.uid).dragEnter(W);if(X){W.stopPropagation()}},V.uid);S.addEvent(U,"drop",function(W){W.preventDefault();var X=Q.get(T.uid).dragDrop(W);if(X){W.stopPropagation()}},V.uid);return T.shimExec.call(this,"FileDrop","init")}};return(R.FileDrop=P)});I("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(P,R,Q){return(P.FileReader=R.extend({},Q))});I("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(Q,R,P){return(Q.FileReaderSync=R.extend({},P))});I("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(P,R,Q){return(P.Transporter=R.extend({},Q))});I("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/silverlight/file/FileReaderSync","moxie/runtime/silverlight/runtime/Transporter"],function(Q,S,T,R,P){return(Q.XMLHttpRequest=S.extend({},T))});I("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/runtime/flash/image/Image"],function(R,S,P,Q){return(R.Image=S.extend({},Q,{getInfo:function(){var T=this.getRuntime(),V=["tiff","exif","gps","thumb"],W={meta:{}},U=T.shimExec.call(this,"Image","getInfo");if(U.meta){S.each(V,function(Z){var b=U.meta[Z],X,Y,a,c;if(b&&b.keys){W.meta[Z]={};for(Y=0,a=b.keys.length;Y<a;Y++){X=b.keys[Y];c=b[X];if(c){if(/^(\d|[1-9]\d+)$/.test(c)){c=parseInt(c,10)}else{if(/^\d*\.\d+$/.test(c)){c=parseFloat(c)}}W.meta[Z][X]=c}}}});if(W.meta&&W.meta.thumb&&W.meta.thumb.data&&!(T.meta.thumb.data instanceof P)){W.meta.thumb.data=new P(T.uid,W.meta.thumb.data)}}W.width=parseInt(U.width,10);W.height=parseInt(U.height,10);W.size=parseInt(U.size,10);W.type=U.type;W.name=U.name;return W},resize:function(V,U,T){this.getRuntime().shimExec.call(this,"Image","resize",V.x,V.y,V.width,V.height,U,T.preserveHeaders,T.resample)}}))});I("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(V,T,R,Q){var P="html4",U={};function S(Y){var X=this,Z=R.capTest,W=R.capTrue;R.call(this,Y,P,{access_binary:Z(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:false,display_media:Z((Q.can("create_canvas")||Q.can("use_data_uri_over32kb"))&&N("moxie/image/Image")),do_cors:false,drag_and_drop:false,filter_by_extension:Z(function(){return !((Q.browser==="Chrome"&&Q.verComp(Q.version,28,"<"))||(Q.browser==="IE"&&Q.verComp(Q.version,10,"<"))||(Q.browser==="Safari"&&Q.verComp(Q.version,7,"<"))||(Q.browser==="Firefox"&&Q.verComp(Q.version,37,"<")))}()),resize_image:function(){return U.Image&&X.can("access_binary")&&Q.can("create_canvas")},report_upload_progress:false,return_response_headers:false,return_response_type:function(a){if(a==="json"&&!!window.JSON){return true}return !!~V.inArray(a,["text","document",""])},return_status_code:function(a){return !V.arrayDiff(a,[200,404])},select_file:function(){return Q.can("use_fileinput")},select_multiple:false,send_binary_string:false,send_custom_headers:false,send_multipart:true,slice_blob:false,stream_upload:function(){return X.can("select_file")},summon_file_dialog:function(){return X.can("select_file")&&((Q.browser==="Firefox"&&Q.verComp(Q.version,4,">="))||(Q.browser==="Opera"&&Q.verComp(Q.version,12,">="))||(Q.browser==="IE"&&Q.verComp(Q.version,10,">="))||!!~V.inArray(Q.browser,["Chrome","Safari"]))},upload_filesize:W,use_http_method:function(a){return !V.arrayDiff(a,["GET","POST"])}});V.extend(this,{init:function(){this.trigger("Init")},destroy:(function(a){return function(){a.call(X);a=X=null}}(this.destroy))});V.extend(this.getShim(),U)}R.addConstructor(P,S);return U});I("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(T,S,Q,W,V,U,R){function P(){var a,Z=[],X,b;function Y(){var g=this,d=g.getRuntime(),h,f,e,c,i,j;j=Q.guid("uid_");h=d.getShimContainer();if(a){e=W.get(a+"_form");if(e){Q.extend(e.style,{top:"100%"})}}c=document.createElement("form");c.setAttribute("id",j+"_form");c.setAttribute("method","post");c.setAttribute("enctype","multipart/form-data");c.setAttribute("encoding","multipart/form-data");Q.extend(c.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});i=document.createElement("input");i.setAttribute("id",j);i.setAttribute("type","file");i.setAttribute("accept",Z.join(","));Q.extend(i.style,{fontSize:"999px",opacity:0});c.appendChild(i);h.appendChild(c);Q.extend(i.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});if(R.browser==="IE"&&R.verComp(R.version,10,"<")){Q.extend(i.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"})}i.onchange=function(){var k;if(!this.value){return}if(this.files){k=this.files[0];if(k.size===0){c.parentNode.removeChild(c);return}}else{k={name:this.value}}k=new S(d.uid,k);this.onchange=function(){};Y.call(g);g.files=[k];i.setAttribute("id",k.uid);c.setAttribute("id",k.uid+"_form");g.trigger("change");i=c=null};if(d.can("summon_file_dialog")){f=W.get(X.browse_button);V.removeEvent(f,"click",g.uid);V.addEvent(f,"click",function(k){if(i&&!i.disabled){i.click()}k.preventDefault()},g.uid)}a=j;h=e=f=null}Q.extend(this,{init:function(e){var f=this,d=f.getRuntime(),c;X=e;Z=e.accept.mimes||U.extList2mimes(e.accept,d.can("filter_by_extension"));c=d.getShimContainer();(function(){var i,g,h;i=W.get(e.browse_button);b=W.getStyle(i,"z-index")||"auto";if(d.can("summon_file_dialog")){if(W.getStyle(i,"position")==="static"){i.style.position="relative"}f.bind("Refresh",function(){g=parseInt(b,10)||1;W.get(X.browse_button).style.zIndex=g;this.getRuntime().getShimContainer().style.zIndex=g-1})}h=d.can("summon_file_dialog")?i:c;V.addEvent(h,"mouseover",function(){f.trigger("mouseenter")},f.uid);V.addEvent(h,"mouseout",function(){f.trigger("mouseleave")},f.uid);V.addEvent(h,"mousedown",function(){f.trigger("mousedown")},f.uid);V.addEvent(W.get(e.container),"mouseup",function(){f.trigger("mouseup")},f.uid);i=null}());Y.call(this);c=null;f.trigger({type:"ready",async:true})},setOption:function(d,f){var c=this.getRuntime();var e;if(d=="accept"){Z=f.mimes||U.extList2mimes(f,c.can("filter_by_extension"))}e=W.get(a);if(e){e.setAttribute("accept",Z.join(","))}},disable:function(d){var c;if((c=W.get(a))){c.disabled=!!d}},destroy:function(){var d=this.getRuntime(),f=d.getShim(),c=d.getShimContainer(),e=X&&W.get(X.container),g=X&&W.get(X.browse_button);if(e){V.removeAllEvents(e,this.uid)}if(g){V.removeAllEvents(g,this.uid);g.style.zIndex=b}if(c){V.removeAllEvents(c,this.uid);c.innerHTML=""}f.removeInstance(this.uid);a=Z=X=c=e=g=f=null}})}return(T.FileInput=P)});I("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(P,Q){return(P.FileReader=Q)});I("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData"],function(T,P,X,Q,V,U,S,W){function R(){var Z,a,Y;function b(c){var j=this,g,f,d,e,h=false;if(!Y){return}g=Y.id.replace(/_iframe$/,"");f=X.get(g+"_form");if(f){d=f.getElementsByTagName("input");e=d.length;while(e--){switch(d[e].getAttribute("type")){case"hidden":d[e].parentNode.removeChild(d[e]);break;case"file":h=true;break}}d=[];if(!h){f.parentNode.removeChild(f)}f=null}setTimeout(function(){U.removeEvent(Y,"load",j.uid);if(Y.parentNode){Y.parentNode.removeChild(Y)}var i=j.getRuntime().getShimContainer();if(!i.children.length){i.parentNode.removeChild(i)}i=Y=null;c()},1)}P.extend(this,{send:function(g,f){var i=this,e=i.getRuntime(),h,c,j,k;Z=a=null;function d(){var l=e.getShimContainer()||document.body,m=document.createElement("div");m.innerHTML='<iframe id="'+h+'_iframe" name="'+h+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';Y=m.firstChild;l.appendChild(Y);U.addEvent(Y,"load",function(){var n;try{n=Y.contentWindow.document||Y.contentDocument||window.frames[Y.id].document;if(/^4(0[0-9]|1[0-7]|2[2346])\s/.test(n.title)){Z=n.title.replace(/^(\d+).*$/,"$1")}else{Z=200;a=P.trim(n.body.innerHTML);i.trigger({type:"progress",loaded:a.length,total:a.length});if(k){i.trigger({type:"uploadprogress",loaded:k.size||1025,total:k.size||1025})}}}catch(o){if(Q.hasSameOrigin(g.url)){Z=404}else{b.call(i,function(){i.trigger("error")});return}}b.call(i,function(){i.trigger("load")})},i.uid)}if(f instanceof W&&f.hasBlob()){k=f.getBlob();h=k.uid;j=X.get(h);c=X.get(h+"_form");if(!c){throw new V.DOMException(V.DOMException.NOT_FOUND_ERR)}}else{h=P.guid("uid_");c=document.createElement("form");c.setAttribute("id",h+"_form");c.setAttribute("method",g.method);c.setAttribute("enctype","multipart/form-data");c.setAttribute("encoding","multipart/form-data");e.getShimContainer().appendChild(c)}c.setAttribute("target",h+"_iframe");if(f instanceof W){f.each(function(m,l){if(m instanceof S){if(j){j.setAttribute("name",l)}}else{var n=document.createElement("input");P.extend(n,{type:"hidden",name:l,value:m});if(j){c.insertBefore(n,j)}else{c.appendChild(n)}}})}c.setAttribute("action",g.url);d();c.submit();i.trigger("loadstart")},getStatus:function(){return Z},getResponse:function(c){if("json"===c){if(P.typeOf(a)==="string"&&!!window.JSON){try{return JSON.parse(a.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(d){return null}}}else{if("document"===c){}}return a},abort:function(){var c=this;if(Y&&Y.contentWindow){if(Y.contentWindow.stop){Y.contentWindow.stop()}else{if(Y.contentWindow.document.execCommand){Y.contentWindow.document.execCommand("Stop")}else{Y.src="about:blank"}}}b.call(this,function(){c.dispatchEvent("abort")})}})}return(T.XMLHttpRequest=R)});I("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(Q,P){return(Q.Image=P)});K(["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Dom","moxie/core/EventTarget","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/core/I18n","moxie/core/utils/Mime","moxie/file/FileInput","moxie/file/File","moxie/file/FileDrop","moxie/file/FileReader","moxie/core/utils/Url","moxie/runtime/RuntimeTarget","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/runtime/Transporter","moxie/image/Image","moxie/core/utils/Events","moxie/runtime/html5/image/ResizerCanvas"])})(this)}))}),(function(C,E,B){var A,D,F;(function(G,I){var H=function(){var J={};I.apply(J,arguments);return J.plupload};if(true){!(D=[B(0)],A=(H),F=(typeof A==="function"?(A.apply(E,D)):A),F!==undefined&&(C.exports=F))}else{if(typeof C==="object"&&C.exports){C.exports=H(require("./moxie"))}else{G.plupload=H(G.moxie)}}}(this||window,function(G){(function(Q,N,O){var I=window.setTimeout;var H={};var J=N.core.utils;var P=N.runtime.Runtime;function K(T){var R=T.required_features,U={};function S(W,Y,X){var V={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};if(V[W]){U[V[W]]=Y}else{if(!X){U[W]=Y}}}if(typeof(R)==="string"){M.each(R.split(/\s*,\s*/),function(V){S(V,true)})}else{if(typeof(R)==="object"){M.each(R,function(W,V){S(V,W)})}else{if(R===true){if(T.chunk_size&&T.chunk_size>0){U.slice_blob=true}if(!M.isEmptyObj(T.resize)||T.multipart===false){U.send_binary_string=true}if(T.http_method){U.use_http_method=T.http_method}M.each(T,function(W,V){S(V,!!W,true)})}}}return U}var M={VERSION:"2.3.1",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:J.Mime.mimes,ua:J.Env,typeOf:J.Basic.typeOf,extend:J.Basic.extend,guid:J.Basic.guid,getAll:function L(T){var U=[],R;if(M.typeOf(T)!=="array"){T=[T]}var S=T.length;while(S--){R=M.get(T[S]);if(R){U.push(R)}}return U.length?U:null},get:J.Dom.get,each:J.Basic.each,getPos:J.Dom.getPos,getSize:J.Dom.getSize,xmlEncode:function(S){var R={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},T=/[<>&\"\']/g;return S?(""+S).replace(T,function(U){return R[U]?"&"+R[U]+";":U}):S},toArray:J.Basic.toArray,inArray:J.Basic.inArray,inSeries:J.Basic.inSeries,addI18n:N.core.I18n.addI18n,translate:N.core.I18n.translate,sprintf:J.Basic.sprintf,isEmptyObj:J.Basic.isEmptyObj,hasClass:J.Dom.hasClass,addClass:J.Dom.addClass,removeClass:J.Dom.removeClass,getStyle:J.Dom.getStyle,addEvent:J.Events.addEvent,removeEvent:J.Events.removeEvent,removeAllEvents:J.Events.removeAllEvents,cleanName:function(T){var R,S;S=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(R=0;R<S.length;R+=2){T=T.replace(S[R],S[R+1])}T=T.replace(/\s+/g,"_");T=T.replace(/[^a-z0-9_\-\.]+/gi,"");return T},buildUrl:function(R,T){var S="";M.each(T,function(V,U){S+=(S?"&":"")+encodeURIComponent(U)+"="+encodeURIComponent(V)});if(S){R+=(R.indexOf("?")>0?"&":"?")+S}return R},formatSize:function(R){if(R===O||/\D/.test(R)){return M.translate("N/A")}function S(V,U){return Math.round(V*Math.pow(10,U))/Math.pow(10,U)}var T=Math.pow(1024,4);if(R>T){return S(R/T,1)+" "+M.translate("tb")}if(R>(T/=1024)){return S(R/T,1)+" "+M.translate("gb")}if(R>(T/=1024)){return S(R/T,1)+" "+M.translate("mb")}if(R>1024){return Math.round(R/1024)+" "+M.translate("kb")}return R+" "+M.translate("b")},parseSize:J.Basic.parseSizeStr,predictRuntime:function(S,R){var U,T;U=new M.Uploader(S);T=P.thatCan(U.getOption().required_features,R||S.runtimes);U.destroy();return T},addFileFilter:function(S,R){H[S]=R}};M.addFileFilter("mime_types",function(S,T,R){if(S.length&&!S.regexp.test(T.name)){this.trigger("Error",{code:M.FILE_EXTENSION_ERROR,message:M.translate("File extension error."),file:T});R(false)}else{R(true)}});M.addFileFilter("max_file_size",function(R,U,S){var T;R=M.parseSize(R);if(U.size!==T&&R&&U.size>R){this.trigger("Error",{code:M.FILE_SIZE_ERROR,message:M.translate("File size error."),file:U});S(false)}else{S(true)}});M.addFileFilter("prevent_duplicates",function(T,U,R){if(T){var S=this.files.length;while(S--){if(U.name===this.files[S].name&&U.size===this.files[S].size){this.trigger("Error",{code:M.FILE_DUPLICATE_ERROR,message:M.translate("Duplicate file error."),file:U});R(false);return}}}R(true)});M.Uploader=function(d){var j=M.guid(),c,U=[],i={},e=[],X=[],l,n,V=false,Y;function Z(){var v,u=0,t;if(this.state==M.STARTED){for(t=0;t<U.length;t++){if(!v&&U[t].status==M.QUEUED){v=U[t];if(this.trigger("BeforeUpload",v)){v.status=M.UPLOADING;this.trigger("UploadFile",v)}}else{u++}}if(u==U.length){if(this.state!==M.STOPPED){this.state=M.STOPPED;this.trigger("StateChanged")}this.trigger("UploadComplete",U)}}}function h(t){t.percent=t.size>0?Math.ceil(t.loaded/t.size*100):100;T()}function T(){var t,w;var u;var v=0;n.reset();for(t=0;t<U.length;t++){w=U[t];if(w.size!==O){n.size+=w.origSize;u=w.loaded*w.origSize/w.size;if(!w.completeTimestamp||w.completeTimestamp>l){v+=u}n.loaded+=u}else{n.size=O}if(w.status==M.DONE){n.uploaded++}else{if(w.status==M.FAILED){n.failed++}else{n.queued++}}}if(n.size===O){n.percent=U.length>0?Math.ceil(n.uploaded/U.length*100):0}else{n.bytesPerSec=Math.ceil(v/((+new Date()-l||1)/1000));n.percent=n.size>0?Math.ceil(n.loaded/n.size*100):0}}function o(){var t=e[0]||X[0];if(t){return t.getRuntime().uid}return false}function b(v,t){if(v.ruid){var u=P.getInfo(v.ruid);if(u){return u.can(t)}}return false}function k(){this.bind("FilesAdded FilesRemoved",function(t){t.trigger("QueueChanged");t.refresh()});this.bind("CancelUpload",q);this.bind("BeforeUpload",W);this.bind("UploadFile",m);this.bind("UploadProgress",S);this.bind("StateChanged",p);this.bind("QueueChanged",T);this.bind("Error",s);this.bind("FileUploaded",f);this.bind("Destroy",r)}function a(w,t){var u=this,x=0,y=[];var v={runtime_order:w.runtimes,required_caps:w.required_features,preferred_caps:i,swf_url:w.flash_swf_url,xap_url:w.silverlight_xap_url};M.each(w.runtimes.split(/\s*,\s*/),function(z){if(w[z]){v[z]=w[z]}});if(w.browse_button){M.each(w.browse_button,function(z){y.push(function(Aa){var Ab=new N.file.FileInput(M.extend({},v,{accept:w.filters.mime_types,name:w.file_data_name,multiple:w.multi_selection,container:w.container,browse_button:z}));Ab.onready=function(){var Ac=P.getInfo(this.ruid);M.extend(u.features,{chunks:Ac.can("slice_blob"),multipart:Ac.can("send_multipart"),multi_selection:Ac.can("select_multiple")});x++;e.push(this);Aa()};Ab.onchange=function(){u.addFile(this.files)};Ab.bind("mouseenter mouseleave mousedown mouseup",function(Ac){if(!V){if(w.browse_button_hover){if("mouseenter"===Ac.type){M.addClass(z,w.browse_button_hover)}else{if("mouseleave"===Ac.type){M.removeClass(z,w.browse_button_hover)}}}if(w.browse_button_active){if("mousedown"===Ac.type){M.addClass(z,w.browse_button_active)}else{if("mouseup"===Ac.type){M.removeClass(z,w.browse_button_active)}}}}});Ab.bind("mousedown",function(){u.trigger("Browse")});Ab.bind("error runtimeerror",function(){Ab=null;Aa()});Ab.init()})})}if(w.drop_element){M.each(w.drop_element,function(z){y.push(function(Aa){var Ab=new N.file.FileDrop(M.extend({},v,{drop_zone:z}));Ab.onready=function(){var Ac=P.getInfo(this.ruid);M.extend(u.features,{chunks:Ac.can("slice_blob"),multipart:Ac.can("send_multipart"),dragdrop:Ac.can("drag_and_drop")});x++;X.push(this);Aa()};Ab.ondrop=function(){u.addFile(this.files)};Ab.bind("error runtimeerror",function(){Ab=null;Aa()});Ab.init()})})}M.inSeries(y,function(){if(typeof(t)==="function"){t(x)}})}function g(v,x,t){var u=new N.image.Image();try{u.onload=function(){if(x.width>this.width&&x.height>this.height&&x.quality===O&&x.preserve_headers&&!x.crop){this.destroy();return t(v)}u.downsize(x.width,x.height,x.crop,x.preserve_headers)};u.onresize=function(){t(this.getAsBlob(v.type,x.quality));this.destroy()};u.onerror=function(){t(v)};u.load(v)}catch(w){t(v)}}function R(u,x,y){var v=this,t=false;function w(z,Ab,Ac){var Aa=c[z];switch(z){case"max_file_size":if(z==="max_file_size"){c.max_file_size=c.filters.max_file_size=Ab}break;case"chunk_size":if(Ab=M.parseSize(Ab)){c[z]=Ab;c.send_file_name=true}break;case"multipart":c[z]=Ab;if(!Ab){c.send_file_name=true}break;case"http_method":c[z]=Ab.toUpperCase()==="PUT"?"PUT":"POST";break;case"unique_names":c[z]=Ab;if(Ab){c.send_file_name=true}break;case"filters":if(M.typeOf(Ab)==="array"){Ab={mime_types:Ab}}if(Ac){M.extend(c.filters,Ab)}else{c.filters=Ab}if(Ab.mime_types){if(M.typeOf(Ab.mime_types)==="string"){Ab.mime_types=N.core.utils.Mime.mimes2extList(Ab.mime_types)}Ab.mime_types.regexp=(function(Ad){var Ae=[];M.each(Ad,function(Af){M.each(Af.extensions.split(/,/),function(Ag){if(/^\s*\*\s*$/.test(Ag)){Ae.push("\\.*")}else{Ae.push("\\."+Ag.replace(new RegExp("["+("/^$.*+?|()[]{}\\".replace(/./g,"\\$&"))+"]","g"),"\\$&"))}})});return new RegExp("("+Ae.join("|")+")$","i")}(Ab.mime_types));c.filters.mime_types=Ab.mime_types}break;case"resize":if(Ab){c.resize=M.extend({preserve_headers:true,crop:false},Ab)}else{c.resize=false}break;case"prevent_duplicates":c.prevent_duplicates=c.filters.prevent_duplicates=!!Ab;break;case"container":case"browse_button":case"drop_element":Ab="container"===z?M.get(Ab):M.getAll(Ab);case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":c[z]=Ab;if(!Ac){t=true}break;default:c[z]=Ab}if(!Ac){v.trigger("OptionChanged",z,Ab,Aa)}}if(typeof(u)==="object"){M.each(u,function(Aa,z){w(z,Aa,y)})}else{w(u,x,y)}if(y){c.required_features=K(M.extend({},c));i=K(M.extend({},c,{required_features:true}))}else{if(t){v.trigger("Destroy");a.call(v,c,function(z){if(z){v.runtime=P.getInfo(o()).type;v.trigger("Init",{runtime:v.runtime});v.trigger("PostInit")}else{v.trigger("Error",{code:M.INIT_ERROR,message:M.translate("Init error.")})}})}}}function W(v,u){if(v.settings.unique_names){var t=u.name.match(/\.([^.]+)$/),w="part";if(t){w=t[1]}u.target_name=u.id+"."+w}}function m(z,x){var Ac=z.settings.url,Aa=z.settings.chunk_size,u=z.settings.max_retries,Ad=z.features,v=0,w;if(x.loaded){v=x.loaded=Aa?Aa*Math.floor(x.loaded/Aa):0}function Ab(){if(u-->0){I(y,1000)}else{x.loaded=v;z.trigger("Error",{code:M.HTTP_ERROR,message:M.translate("HTTP Error."),file:x,response:Y.responseText,status:Y.status,responseHeaders:Y.getAllResponseHeaders()})}}function y(){var Af,Ag={},Ae;if(x.status!==M.UPLOADING||z.state===M.STOPPED){return}if(z.settings.send_file_name){Ag.name=x.target_name||x.name}if(Aa&&Ad.chunks&&w.size>Aa){Ae=Math.min(Aa,w.size-v);Af=w.slice(v,v+Ae)}else{Ae=w.size;Af=w}if(Aa&&Ad.chunks){if(z.settings.send_chunk_number){Ag.chunk=Math.ceil(v/Aa);Ag.chunks=Math.ceil(w.size/Aa)}else{Ag.offset=v;Ag.total=w.size}}if(z.trigger("BeforeChunkUpload",x,Ag,Af,v)){t(Ag,Af,Ae)}}function t(Ah,Af,Ae){var Ag;Y=new N.xhr.XMLHttpRequest();if(Y.upload){Y.upload.onprogress=function(Ai){x.loaded=Math.min(x.size,v+Ai.loaded);z.trigger("UploadProgress",x)}}Y.onload=function(){if(Y.status>=400){Ab();return}u=z.settings.max_retries;if(Ae<w.size){Af.destroy();v+=Ae;x.loaded=Math.min(v,w.size);z.trigger("ChunkUploaded",x,{offset:x.loaded,total:w.size,response:Y.responseText,status:Y.status,responseHeaders:Y.getAllResponseHeaders()});if(M.ua.browser==="Android Browser"){z.trigger("UploadProgress",x)}}else{x.loaded=x.size}Af=Ag=null;if(!v||v>=w.size){if(x.size!=x.origSize){w.destroy();w=null}z.trigger("UploadProgress",x);x.status=M.DONE;x.completeTimestamp=+new Date();z.trigger("FileUploaded",x,{response:Y.responseText,status:Y.status,responseHeaders:Y.getAllResponseHeaders()})}else{I(y,1)}};Y.onerror=function(){Ab()};Y.onloadend=function(){this.destroy();Y=null};if(z.settings.multipart&&Ad.multipart){Y.open(z.settings.http_method,Ac,true);M.each(z.settings.headers,function(Aj,Ai){Y.setRequestHeader(Ai,Aj)});Ag=new N.xhr.FormData();M.each(M.extend(Ah,z.settings.multipart_params),function(Aj,Ai){Ag.append(Ai,Aj)});Ag.append(z.settings.file_data_name,Af);Y.send(Ag,{runtime_order:z.settings.runtimes,required_caps:z.settings.required_features,preferred_caps:i,swf_url:z.settings.flash_swf_url,xap_url:z.settings.silverlight_xap_url})}else{Ac=M.buildUrl(z.settings.url,M.extend(Ah,z.settings.multipart_params));Y.open(z.settings.http_method,Ac,true);M.each(z.settings.headers,function(Aj,Ai){Y.setRequestHeader(Ai,Aj)});if(!Y.hasRequestHeader("Content-Type")){Y.setRequestHeader("Content-Type","application/octet-stream")}Y.send(Af,{runtime_order:z.settings.runtimes,required_caps:z.settings.required_features,preferred_caps:i,swf_url:z.settings.flash_swf_url,xap_url:z.settings.silverlight_xap_url})}}w=x.getSource();if(!M.isEmptyObj(z.settings.resize)&&b(w,"send_binary_string")&&M.inArray(w.type,["image/jpeg","image/png"])!==-1){g.call(this,w,z.settings.resize,function(Ae){w=Ae;x.size=Ae.size;y()})}else{y()}}function S(u,t){h(t)}function p(u){if(u.state==M.STARTED){l=(+new Date())}else{if(u.state==M.STOPPED){for(var t=u.files.length-1;t>=0;t--){if(u.files[t].status==M.UPLOADING){u.files[t].status=M.QUEUED;T()}}}}}function q(){if(Y){Y.abort()}}function f(t){T();I(function(){Z.call(t)},1)}function s(u,t){if(t.code===M.INIT_ERROR){u.destroy()}else{if(t.code===M.HTTP_ERROR){t.file.status=M.FAILED;t.file.completeTimestamp=+new Date();h(t.file);if(u.state==M.STARTED){u.trigger("CancelUpload");I(function(){Z.call(u)},1)}}}}function r(t){t.stop();M.each(U,function(u){u.destroy()});U=[];if(e.length){M.each(e,function(u){u.destroy()});e=[]}if(X.length){M.each(X,function(u){u.destroy()});X=[]}i={};V=false;l=Y=null;n.reset()}c={chunk_size:0,file_data_name:"file",filters:{mime_types:[],prevent_duplicates:false,max_file_size:0},flash_swf_url:"js/Moxie.swf",http_method:"POST",max_retries:0,multipart:true,multi_selection:true,resize:false,runtimes:P.order,send_file_name:true,send_chunk_number:true,silverlight_xap_url:"js/Moxie.xap"};R.call(this,d,null,true);n=new M.QueueProgress();M.extend(this,{id:j,uid:j,state:M.STOPPED,features:{},runtime:null,files:U,settings:c,total:n,init:function(){var t=this,w,u,v;u=t.getOption("preinit");if(typeof(u)=="function"){u(t)}else{M.each(u,function(x,y){t.bind(y,x)})}k.call(t);M.each(["container","browse_button","drop_element"],function(x){if(t.getOption(x)===null){v={code:M.INIT_ERROR,message:M.sprintf(M.translate("%s specified, but cannot be found."),x)};return false}});if(v){return t.trigger("Error",v)}if(!c.browse_button&&!c.drop_element){return t.trigger("Error",{code:M.INIT_ERROR,message:M.translate("You must specify either browse_button or drop_element.")})}a.call(t,c,function(y){var x=t.getOption("init");if(typeof(x)=="function"){x(t)}else{M.each(x,function(z,Aa){t.bind(Aa,z)})}if(y){t.runtime=P.getInfo(o()).type;t.trigger("Init",{runtime:t.runtime});t.trigger("PostInit")}else{t.trigger("Error",{code:M.INIT_ERROR,message:M.translate("Init error.")})}})},setOption:function(t,u){R.call(this,t,u,!this.runtime)},getOption:function(t){if(!t){return c}return c[t]},refresh:function(){if(e.length){M.each(e,function(t){t.trigger("Refresh")})}this.trigger("Refresh")},start:function(){if(this.state!=M.STARTED){this.state=M.STARTED;this.trigger("StateChanged");Z.call(this)}},stop:function(){if(this.state!=M.STOPPED){this.state=M.STOPPED;this.trigger("StateChanged");this.trigger("CancelUpload")}},disableBrowse:function(){V=arguments[0]!==O?arguments[0]:true;if(e.length){M.each(e,function(t){t.disable(V)})}this.trigger("DisableBrowse",V)},getFile:function(u){var t;for(t=U.length-1;t>=0;t--){if(U[t].id===u){return U[t]}}},addFile:function(z,y){var Aa=this,w=[],u=[],v;function t(Ac,Ab){var Ad=[];M.each(Aa.settings.filters,function(Ae,Af){if(H[Af]){Ad.push(function(Ag){H[Af].call(Aa,Ae,Ac,function(Ah){Ag(!Ah)})})}});M.inSeries(Ad,Ab)}function x(Ac){var Ab=M.typeOf(Ac);if(Ac instanceof N.file.File){if(!Ac.ruid&&!Ac.isDetached()){if(!v){return false}Ac.ruid=v;Ac.connectRuntime(v)}x(new M.File(Ac))}else{if(Ac instanceof N.file.Blob){x(Ac.getSource());Ac.destroy()}else{if(Ac instanceof M.File){if(y){Ac.name=y}w.push(function(Ad){t(Ac,function(Ae){if(!Ae){U.push(Ac);u.push(Ac);Aa.trigger("FileFiltered",Ac)}I(Ad,1)})})}else{if(M.inArray(Ab,["file","blob"])!==-1){x(new N.file.File(null,Ac))}else{if(Ab==="node"&&M.typeOf(Ac.files)==="filelist"){M.each(Ac.files,x)}else{if(Ab==="array"){y=null;M.each(Ac,x)}}}}}}}v=o();x(z);if(w.length){M.inSeries(w,function(){if(u.length){Aa.trigger("FilesAdded",u)}})}},removeFile:function(u){var v=typeof(u)==="string"?u:u.id;for(var t=U.length-1;t>=0;t--){if(U[t].id===v){return this.splice(t,1)[0]}}},splice:function(w,t){var v=U.splice(w===O?0:w,t===O?U.length:t);var u=false;if(this.state==M.STARTED){M.each(v,function(x){if(x.status===M.UPLOADING){u=true;return false}});if(u){this.stop()}}this.trigger("FilesRemoved",v);M.each(v,function(x){x.destroy()});if(u){this.start()}return v},dispatchEvent:function(t){var w,x,v;t=t.toLowerCase();w=this.hasEventListener(t);if(w){w.sort(function(z,y){return y.priority-z.priority});x=[].slice.call(arguments);x.shift();x.unshift(this);for(var u=0;u<w.length;u++){if(w[u].fn.apply(w[u].scope,x)===false){return false}}}return true},bind:function(u,t,w,v){M.Uploader.prototype.bind.call(this,u,t,v,w)},destroy:function(){this.trigger("Destroy");c=n=null;this.unbindAll()}})};M.Uploader.prototype=N.core.EventTarget.instance;M.File=(function(){var R={};function S(T){M.extend(this,{id:M.guid(),name:T.name||T.fileName,type:T.type||"",size:T.size||T.fileSize,origSize:T.size||T.fileSize,loaded:0,percent:0,status:M.QUEUED,lastModifiedDate:T.lastModifiedDate||(new Date()).toLocaleString(),completeTimestamp:0,getNative:function(){var U=this.getSource().getSource();return M.inArray(M.typeOf(U),["blob","file"])!==-1?U:null},getSource:function(){if(!R[this.id]){return null}return R[this.id]},destroy:function(){var U=this.getSource();if(U){U.destroy();delete R[this.id]}}});R[this.id]=T}return S}());M.QueueProgress=function(){var R=this;R.size=0;R.loaded=0;R.uploaded=0;R.failed=0;R.queued=0;R.percent=0;R.bytesPerSec=0;R.reset=function(){R.size=R.loaded=R.uploaded=R.failed=R.queued=R.percent=R.bytesPerSec=0}};Q.plupload=M}(this,G))}))}),(function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*
         * qiniu-js-sdk v@VERSION
         *
         * Copyright 2015 by Qiniu
         * Released under GPL V2 License.
         *
         * GitHub: http://github.com/qiniu/js-sdk
         *
         * Date: @DATE
         */
(function(global){function createCookie(key,value,exp){var date=new Date();date.setTime(date.getTime()+(exp*24*60*60*1000));var expires="; expires="+date.toGMTString();document.cookie=key+"="+value+expires+"; path=/"}function readCookie(key){var nameEQ=key+"=";var ca=document.cookie.split(";");for(var i=0,max=ca.length;i<max;i++){var c=ca[i];while(c.charAt(0)===" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)===0){return c.substring(nameEQ.length,c.length)}}return null}if(!window.localStorage){window.localStorage={setItem:function(key,value){createCookie(key,value,30)},getItem:function(key){return readCookie(key)},removeItem:function(key){createCookie(key,"",-1)}}}function QiniuJsSDK(){var moxie=__webpack_require__(0);window.moxie=moxie;var plupload=__webpack_require__(1);window.plupload=plupload;var that=this;this.detectIEVersion=function(){var v=4,div=document.createElement("div"),all=div.getElementsByTagName("i");while(div.innerHTML="<!--[if gt IE "+v+"]><i></i><![endif]-->",all[0]){v++}return v>4?v:false};var logger={MUTE:0,FATA:1,ERROR:2,WARN:3,INFO:4,DEBUG:5,TRACE:6,level:0};function log(type,args){var header="[qiniu-js-sdk]["+type+"]";var msg=header;for(var i=0;i<args.length;i++){if(typeof args[i]==="string"){msg+=" "+args[i]}else{msg+=" "+that.stringifyJSON(args[i])}}if(that.detectIEVersion()){console.log(msg)}else{args.unshift(header);console.log.apply(console,args)}if(document.getElementById("qiniu-js-sdk-log")){document.getElementById("qiniu-js-sdk-log").innerHTML+="<p>"+msg+"</p>"}}function makeLogFunc(code){var func=code.toLowerCase();logger[func]=function(){if(window.console&&window.console.log&&logger.level>=logger[code]){var args=Array.prototype.slice.call(arguments);log(func,args)}}}for(var property in logger){if(logger.hasOwnProperty(property)&&(typeof logger[property])==="number"&&!logger.hasOwnProperty(property.toLowerCase())){makeLogFunc(property)}}var qiniuUploadUrl;if(window.location.protocol==="https:"){qiniuUploadUrl="https://up.qbox.me"}else{qiniuUploadUrl="http://upload.qiniu.com"}var qiniuUploadUrls=["http://upload.qiniu.com","http://up.qiniu.com"];var qiniuUpHosts={"http":["http://upload.qiniu.com","http://up.qiniu.com"],"https":["https://up.qbox.me"]};var changeUrlTimes=0;function StatisticsLogger(){var qiniuCollectUploadLogUrl="https://uplog.qbox.me/log/3";var queue=[];var TaskStatus={waiting:0,processing:1,finished:2};this.log=function(code,req_id,host,remote_ip,port,duration,up_time,bytes_sent,up_type,file_size){var log=Array.prototype.join.call(arguments,",");queue.push({log:log,status:TaskStatus.waiting});logger.debug("[STATISTICS] send log to statistics server",log)};function tick(){var unFinishedTasks=[];for(var i=0;i<queue.length;i++){if(queue[i].status!==TaskStatus.finished){unFinishedTasks.push(queue[i])}if(queue[i].status===TaskStatus.waiting){send(queue[i])}}queue=unFinishedTasks}function send(task){task.status=TaskStatus.processing;var ajax=that.createAjax();ajax.open("POST",qiniuCollectUploadLogUrl,true);ajax.setRequestHeader("Content-type","application/x-www-form-urlencoded");ajax.setRequestHeader("Authorization","UpToken "+that.token);ajax.onreadystatechange=function(){if(ajax.readyState===4){if(ajax.status===200){logger.debug("[STATISTICS] successfully report log to server");task.status=TaskStatus.finished}else{logger.debug("[STATISTICS] report log to server failed");task.status=TaskStatus.waiting}}};ajax.send(task.log)}setInterval(tick,1000)}var statisticsLogger=new StatisticsLogger();var ExtraErrors={ZeroSizeFile:-6,InvalidToken:-5,InvalidArgument:-4,InvalidFile:-3,Cancelled:-2,NetworkError:-1,UnknownError:0,TimedOut:-1001,UnknownHost:-1003,CannotConnectToHost:-1004,NetworkConnectionLost:-1005};this.resetUploadUrl=function(){var hosts=window.location.protocol==="https:"?qiniuUpHosts.https:qiniuUpHosts.http;var i=changeUrlTimes;qiniuUploadUrl=hosts[0];changeUrlTimes++;logger.debug("resetUploadUrl: "+qiniuUploadUrl)};this.isImage=function(url){url=url.split(/[?#]/)[0];return(/\.(png|jpg|jpeg|gif|bmp)$/i).test(url)};this.getFileExtension=function(filename){var tempArr=filename.split(".");var ext;if(tempArr.length===1||(tempArr[0]===""&&tempArr.length===2)){ext=""}else{ext=tempArr.pop().toLowerCase()}return ext};this.utf8_encode=function(argString){if(argString===null||typeof argString==="undefined"){return""}var string=(argString+"");var utftext="",start,end,stringl=0;start=end=0;stringl=string.length;for(var n=0;n<stringl;n++){var c1=string.charCodeAt(n);var enc=null;if(c1<128){end++}else{if(c1>127&&c1<2048){enc=String.fromCharCode((c1>>6)|192,(c1&63)|128)}else{if(c1&63488^55296>0){enc=String.fromCharCode((c1>>12)|224,((c1>>6)&63)|128,(c1&63)|128)}else{if(c1&64512^55296>0){throw new RangeError("Unmatched trail surrogate at "+n)}var c2=string.charCodeAt(++n);if(c2&64512^56320>0){throw new RangeError("Unmatched lead surrogate at "+(n-1))}c1=((c1&1023)<<10)+(c2&1023)+65536;enc=String.fromCharCode((c1>>18)|240,((c1>>12)&63)|128,((c1>>6)&63)|128,(c1&63)|128)}}}if(enc!==null){if(end>start){utftext+=string.slice(start,end)}utftext+=enc;start=end=n+1}}if(end>start){utftext+=string.slice(start,stringl)}return utftext};this.base64_decode=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!data){return data}data+="";do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&255;o2=bits>>8&255;o3=bits&255;if(h3===64){tmp_arr[ac++]=String.fromCharCode(o1)}else{if(h4===64){tmp_arr[ac++]=String.fromCharCode(o1,o2)}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3)}}}while(i<data.length);dec=tmp_arr.join("");return dec};this.base64_encode=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data}data=this.utf8_encode(data+"");do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join("");switch(data.length%3){case 1:enc=enc.slice(0,-2)+"==";break;case 2:enc=enc.slice(0,-1)+"=";break}return enc};this.URLSafeBase64Encode=function(v){v=this.base64_encode(v);return v.replace(/\//g,"_").replace(/\+/g,"-")};this.URLSafeBase64Decode=function(v){v=v.replace(/_/g,"/").replace(/-/g,"+");return this.base64_decode(v)};this.createAjax=function(argument){var xmlhttp={};if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}return xmlhttp};this.parseJSON=function(data){if(window.JSON&&window.JSON.parse){return window.JSON.parse(data)}var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var text=String(data);rx_dangerous.lastIndex=0;if(rx_dangerous.test(text)){text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}return eval("("+text+")")};this.stringifyJSON=function(obj){if(window.JSON&&window.JSON.stringify){return window.JSON.stringify(obj)}switch(typeof(obj)){case"string":return'"'+obj.replace(/(["\\])/g,"\\$1")+'"';case"array":return"["+obj.map(that.stringifyJSON).join(",")+"]";case"object":if(obj instanceof Array){var strArr=[];var len=obj.length;for(var i=0;i<len;i++){strArr.push(that.stringifyJSON(obj[i]))}return"["+strArr.join(",")+"]"}else{if(obj===null){return"null"}else{var string=[];for(var property in obj){if(obj.hasOwnProperty(property)){string.push(that.stringifyJSON(property)+":"+that.stringifyJSON(obj[property]))}}return"{"+string.join(",")+"}"}}break;case"number":return obj;case false:return obj;case"boolean":return obj}};this.trim=function(text){return text===null?"":text.replace(/^\s+|\s+$/g,"")};this.uploader=function(op){var reset_chunk_size=function(){var ie=that.detectIEVersion();var BLOCK_BITS,MAX_CHUNK_SIZE,chunk_size;var isSpecialSafari=(moxie.core.utils.Env.browser==="Safari"&&moxie.core.utils.Env.version<=5&&moxie.core.utils.Env.os==="Windows"&&moxie.core.utils.Env.osVersion==="7")||(moxie.core.utils.Env.browser==="Safari"&&moxie.core.utils.Env.os==="iOS"&&moxie.core.utils.Env.osVersion==="7");if(ie&&ie<9&&op.chunk_size&&op.runtimes.indexOf("flash")>=0){op.chunk_size=0}else{if(isSpecialSafari){op.chunk_size=0}else{BLOCK_BITS=20;MAX_CHUNK_SIZE=4<<BLOCK_BITS;chunk_size=plupload.parseSize(op.chunk_size);if(chunk_size>MAX_CHUNK_SIZE){op.chunk_size=MAX_CHUNK_SIZE}}}};var getHosts=function(hosts){var result=[];var uploadIndex=-1;for(var i=0;i<hosts.length;i++){var host=hosts[i];if(host.indexOf("upload")!==-1){uploadIndex=i}if(host.indexOf("-H")===0){result.push(host.split(" ")[2])}else{result.push(host)}}if(uploadIndex!==-1){var uploadDomain=result[uploadIndex];result[uploadIndex]=result[0];result[0]=uploadDomain}return result};var getPutPolicy=function(uptoken){var segments=uptoken.split(":");var ak=segments[0];var putPolicy=that.parseJSON(that.URLSafeBase64Decode(segments[2]));putPolicy.ak=ak;if(putPolicy.scope.indexOf(":")>=0){putPolicy.bucket=putPolicy.scope.split(":")[0];putPolicy.key=putPolicy.scope.split(":")[1]}else{putPolicy.bucket=putPolicy.scope}return putPolicy};var getUpHosts=function(uptoken){var putPolicy=getPutPolicy(uptoken);var uphosts_url="http://uc.qbox.me/v1/query?ak="+putPolicy.ak+"&bucket="+putPolicy.bucket;logger.debug("putPolicy: ",putPolicy);logger.debug("get uphosts from: ",uphosts_url);var ie=that.detectIEVersion();var ajax;if(ie&&ie<=9){ajax=new moxie.xhr.XMLHttpRequest();moxie.core.utils.Env.swf_url=op.flash_swf_url}else{ajax=that.createAjax()}ajax.open("GET",uphosts_url,false);var onreadystatechange=function(){logger.debug("ajax.readyState: ",ajax.readyState);if(ajax.readyState===4){logger.debug("ajax.status: ",ajax.status);if(ajax.status<400){var res=that.parseJSON(ajax.responseText);qiniuUpHosts.http=getHosts(res.http.up);qiniuUpHosts.https=getHosts(res.https.up);logger.debug("get new uphosts: ",qiniuUpHosts);that.resetUploadUrl()}else{logger.error("get uphosts error: ",ajax.responseText)}}};if(ie&&ie<=9){ajax.bind("readystatechange",onreadystatechange)}else{ajax.onreadystatechange=onreadystatechange}ajax.send();return};var getUptoken=function(file){if(!that.token||(op.uptoken_url&&that.tokenInfo.isExpired())){return getNewUpToken(file)}else{return that.token}};var getNewUpToken=function(file){if(op.uptoken){that.token=op.uptoken}else{if(op.uptoken_url){logger.debug("get uptoken from: ",that.uptoken_url);var ajax=that.createAjax();ajax.open("GET",that.uptoken_url+"?"+(+new Date()),false);ajax.send();if(ajax.status===200){var res=that.parseJSON(ajax.responseText);that.token=res.uptoken;var segments=that.token.split(":");var putPolicy=that.parseJSON(that.URLSafeBase64Decode(segments[2]));if(!that.tokenMap){that.tokenMap={}}var getTimestamp=function(time){return Math.ceil(time.getTime()/1000)};var serverTime=getTimestamp(new Date(ajax.getResponseHeader("date")));var clientTime=getTimestamp(new Date());that.tokenInfo={serverDelay:clientTime-serverTime,deadline:putPolicy.deadline/1000,isExpired:function(){var leftTime=this.deadline-getTimestamp(new Date())+this.serverDelay;return leftTime<600}};logger.debug("get new uptoken: ",that.token);logger.debug("get token info: ",that.tokenInfo)}else{logger.error("get uptoken error: ",ajax.responseText)}}else{if(op.uptoken_func){logger.debug("get uptoken from uptoken_func");that.token=op.uptoken_func(file);logger.debug("get new uptoken: ",that.token)}else{logger.error("one of [uptoken, uptoken_url, uptoken_func] settings in options is required!")}}}if(that.token){getUpHosts(that.token)}return that.token};var getFileKey=function(up,file,func){var key="",unique_names=false;if(!op.save_key){unique_names=up.getOption&&up.getOption("unique_names");unique_names=unique_names||(up.settings&&up.settings.unique_names);if(unique_names){var ext=that.getFileExtension(file.name);key=ext?file.id+"."+ext:file.id}else{if(typeof func==="function"){key=func(up,file)}else{key=file.name}}}return key};var getDomainFromUrl=function(url){if(url&&url.match){var groups=url.match(/^https?:\/\/([^:^/]*)/);return groups?groups[1]:""}return""};var getPortFromUrl=function(url){if(url&&url.match){var groups=url.match(/(^https?)/);if(!groups){return""}var type=groups[1];groups=url.match(/^https?:\/\/([^:^/]*):(\d*)/);if(groups){return groups[2]}else{if(type==="http"){return"80"}else{return"443"}}}return""};if(op.log_level){logger.level=op.log_level}if(!op.domain){throw"domain setting in options is required!"}if(!op.browse_button){throw"browse_button setting in options is required!"}if(!op.uptoken&&!op.uptoken_url&&!op.uptoken_func){throw"one of [uptoken, uptoken_url, uptoken_func] settings in options is required!"}logger.debug("init uploader start");logger.debug("environment: ",moxie.core.utils.Env);logger.debug("userAgent: ",navigator.userAgent);var option={};var _Error_Handler=op.init&&op.init.Error;var _FileUploaded_Handler=op.init&&op.init.FileUploaded;op.init.Error=function(){};op.init.FileUploaded=function(){};that.uptoken_url=op.uptoken_url;that.token="";that.key_handler=typeof op.init.Key==="function"?op.init.Key:"";this.domain=op.domain;var ctx="";var speedCalInfo={isResumeUpload:false,resumeFilesize:0,startTime:"",currentTime:""};reset_chunk_size();logger.debug("invoke reset_chunk_size()");logger.debug("op.chunk_size: ",op.chunk_size);var defaultSetting={url:qiniuUploadUrl,multipart_params:{token:""}};var ie=that.detectIEVersion();if(ie&&ie<=9){defaultSetting.multipart_params.accept="text/plain; charset=utf-8";logger.debug("add accept text/plain in multipart params")}plupload.extend(option,op,defaultSetting);logger.debug("option: ",option);var uploader=new plupload.Uploader(option);logger.debug("new plupload.Uploader(option)");uploader.bind("Init",function(up,params){logger.debug("Init event activated");if(!op.get_new_uptoken){getNewUpToken(null)}});logger.debug("bind Init event");uploader.bind("FilesAdded",function(up,files){logger.debug("FilesAdded event activated");var auto_start=up.getOption&&up.getOption("auto_start");auto_start=auto_start||(up.settings&&up.settings.auto_start);logger.debug("auto_start: ",auto_start);logger.debug("files: ",files);var is_ios=function(){if(moxie.core.utils.Env.OS.toLowerCase()==="ios"){return true}else{return false}};if(is_ios()){for(var i=0;i<files.length;i++){var file=files[i];var ext=that.getFileExtension(file.name);file.name=file.id+"."+ext}}if(auto_start){setTimeout(function(){up.start();logger.debug("invoke up.start()")},0)}up.refresh()});logger.debug("bind FilesAdded event");uploader.bind("BeforeUpload",function(up,file){logger.debug("BeforeUpload event activated");file._start_at=new Date();file.speed=file.speed||0;ctx="";if(op.get_new_uptoken){getNewUpToken(file)}var directUpload=function(up,file,func){speedCalInfo.startTime=new Date().getTime();var multipart_params_obj;if(op.save_key){multipart_params_obj={"token":that.token}}else{multipart_params_obj={"key":getFileKey(up,file,func),"token":that.token}}var ie=that.detectIEVersion();if(ie&&ie<=9){multipart_params_obj.accept="text/plain; charset=utf-8";logger.debug("add accept text/plain in multipart params")}logger.debug("directUpload multipart_params_obj: ",multipart_params_obj);var x_vars=op.x_vars;if(x_vars!==undefined&&typeof x_vars==="object"){for(var x_key in x_vars){if(x_vars.hasOwnProperty(x_key)){if(typeof x_vars[x_key]==="function"){multipart_params_obj["x:"+x_key]=x_vars[x_key](up,file)}else{if(typeof x_vars[x_key]!=="object"){multipart_params_obj["x:"+x_key]=x_vars[x_key]}}}}}up.setOption({"url":qiniuUploadUrl,"multipart":true,"chunk_size":is_android_weixin_or_qq()?op.max_file_size:undefined,"multipart_params":multipart_params_obj})};var is_android_weixin_or_qq=function(){var ua=navigator.userAgent.toLowerCase();if((ua.match(/MicroMessenger/i)||moxie.core.utils.Env.browser==="QQBrowser"||ua.match(/V1_AND_SQ/i))&&moxie.core.utils.Env.OS.toLowerCase()==="android"){return true}else{return false}};var chunk_size=up.getOption&&up.getOption("chunk_size");chunk_size=chunk_size||(up.settings&&up.settings.chunk_size);logger.debug("uploader.runtime: ",uploader.runtime);logger.debug("chunk_size: ",chunk_size);if((uploader.runtime==="html5"||uploader.runtime==="flash")&&chunk_size){if(file.size<chunk_size||is_android_weixin_or_qq()){logger.debug("directUpload because file.size < chunk_size || is_android_weixin_or_qq()");directUpload(up,file,that.key_handler)}else{var localFileInfo=localStorage.getItem(file.name);var blockSize=chunk_size;if(localFileInfo){localFileInfo=that.parseJSON(localFileInfo);var now=(new Date()).getTime();var before=localFileInfo.time||0;var aDay=24*60*60*1000;if(now-before<aDay){if(localFileInfo.percent!==100){if(file.size===localFileInfo.total){file.percent=localFileInfo.percent;file.loaded=localFileInfo.offset;ctx=localFileInfo.ctx;speedCalInfo.isResumeUpload=true;speedCalInfo.resumeFilesize=localFileInfo.offset;if(localFileInfo.offset+blockSize>file.size){blockSize=file.size-localFileInfo.offset}}else{localStorage.removeItem(file.name)}}else{localStorage.removeItem(file.name)}}else{localStorage.removeItem(file.name)}}speedCalInfo.startTime=new Date().getTime();var multipart_params_obj={};var ie=that.detectIEVersion();if(ie&&ie<=9){multipart_params_obj.accept="text/plain; charset=utf-8";logger.debug("add accept text/plain in multipart params")}up.setOption({"url":qiniuUploadUrl+"/mkblk/"+blockSize,"multipart":false,"chunk_size":chunk_size,"required_features":"chunks","headers":{"Authorization":"UpToken "+getUptoken(file)},"multipart_params":multipart_params_obj})}}else{logger.debug("directUpload because uploader.runtime !== 'html5' || uploader.runtime !== 'flash' || !chunk_size");directUpload(up,file,that.key_handler)}});logger.debug("bind BeforeUpload event");uploader.bind("UploadProgress",function(up,file){logger.trace("UploadProgress event activated");speedCalInfo.currentTime=new Date().getTime();var timeUsed=speedCalInfo.currentTime-speedCalInfo.startTime;var fileUploaded=file.loaded||0;if(speedCalInfo.isResumeUpload){fileUploaded=file.loaded-speedCalInfo.resumeFilesize}file.speed=(fileUploaded/timeUsed*1000).toFixed(0)||0});logger.debug("bind UploadProgress event");uploader.bind("ChunkUploaded",function(up,file,info){logger.debug("ChunkUploaded event activated");logger.debug("ChunkUploaded file: ",file);logger.debug("ChunkUploaded info: ",info);var res=that.parseJSON(info.response);logger.debug("ChunkUploaded res: ",res);ctx=ctx?ctx+","+res.ctx:res.ctx;var leftSize=info.total-info.offset;var chunk_size=up.getOption&&up.getOption("chunk_size");chunk_size=chunk_size||(up.settings&&up.settings.chunk_size);if(leftSize<chunk_size){up.setOption({"url":qiniuUploadUrl+"/mkblk/"+leftSize});logger.debug("up.setOption url: ",qiniuUploadUrl+"/mkblk/"+leftSize)}up.setOption({"headers":{"Authorization":"UpToken "+getUptoken(file)}});localStorage.setItem(file.name,that.stringifyJSON({ctx:ctx,percent:file.percent,total:info.total,offset:info.offset,time:(new Date()).getTime()}))});logger.debug("bind ChunkUploaded event");var retries=op.max_retries;var unknow_error_retry=function(file){if(retries-->0){setTimeout(function(){that.resetUploadUrl();file.status=plupload.QUEUED;uploader.stop();uploader.start()},0);return true}else{retries=qiniuUploadUrls.length;return false}};uploader.bind("Error",(function(_Error_Handler){return function(up,err){logger.error("Error event activated");logger.error("err: ",err);var nowTime=new Date();var errTip="";var file=err.file;if(file){switch(err.code){case plupload.FAILED:errTip="";break;case plupload.FILE_SIZE_ERROR:var max_file_size=up.getOption&&up.getOption("max_file_size");max_file_size=max_file_size||(up.settings&&up.settings.max_file_size);errTip=""+max_file_size+"";break;case plupload.FILE_EXTENSION_ERROR:errTip="";break;case plupload.HTTP_ERROR:if(err.response===""){errTip=err.message||"";if(!unknow_error_retry(file)){return}break}var errorObj=that.parseJSON(err.response);var errorText=errorObj.error;switch(err.status){case 400:errTip="";break;case 401:errTip="";break;case 405:errTip="";break;case 579:errTip="";break;case 599:errTip="";if(!unknow_error_retry(file)){return}break;case 614:errTip="";try{errorObj=that.parseJSON(errorObj.error);errorText=errorObj.error||"file exists"}catch(e){errorText=errorObj.error||"file exists"}break;case 631:errTip="";break;case 701:errTip="";break;default:errTip="";if(!unknow_error_retry(file)){return}break}errTip=errTip+"("+err.status+""+errorText+")";break;case plupload.SECURITY_ERROR:errTip="";break;case plupload.GENERIC_ERROR:errTip="";break;case plupload.IO_ERROR:errTip="";break;case plupload.INIT_ERROR:errTip="";uploader.destroy();break;default:errTip=err.message+err.details;if(!unknow_error_retry(file)){return}break}if(_Error_Handler){_Error_Handler(up,err,errTip)}}up.refresh();if(!op.disable_statistics_report){var matchedGroups=(err&&err.responseHeaders&&err.responseHeaders.match)?err.responseHeaders.match(/(X-Reqid\:\ )([\w\.\%-]*)/):[];console.log(err);var req_id=matchedGroups[2].replace(/[\r\n]/g,"");var errcode=plupload.HTTP_ERROR?err.status:err.code;var startAt=file._start_at?file._start_at.getTime():nowTime.getTime();statisticsLogger.log(errcode===0?ExtraErrors.NetworkError:errcode,req_id,getDomainFromUrl(up.settings.url),undefined,getPortFromUrl(up.settings.url),(nowTime.getTime()-startAt)/1000,parseInt(startAt/1000),err.file.size*(err.file.percent/100),"jssdk-"+up.runtime,file.size)}}})(_Error_Handler));logger.debug("bind Error event");uploader.bind("FileUploaded",(function(_FileUploaded_Handler){return function(up,file,info){logger.debug("FileUploaded event activated");logger.debug("FileUploaded file: ",file);logger.debug("FileUploaded info: ",info);var nowTime=new Date();var last_step=function(up,file,info){logger.debug("FileUploaded last step:",info);if(op.downtoken_url){var ajax_downtoken=that.createAjax();ajax_downtoken.open("POST",op.downtoken_url,true);ajax_downtoken.setRequestHeader("Content-type","application/x-www-form-urlencoded");ajax_downtoken.onreadystatechange=function(){if(ajax_downtoken.readyState===4){if(ajax_downtoken.status===200){var res_downtoken;try{res_downtoken=that.parseJSON(ajax_downtoken.responseText)}catch(e){throw ("invalid json format")}var info_extended={};plupload.extend(info_extended,that.parseJSON(info.response),res_downtoken);info.response=that.stringifyJSON(info_extended);if(_FileUploaded_Handler){_FileUploaded_Handler(up,file,info)}}else{uploader.trigger("Error",{status:ajax_downtoken.status,response:ajax_downtoken.responseText,file:file,code:plupload.HTTP_ERROR})}}};ajax_downtoken.send("key="+that.parseJSON(info.response).key+"&domain="+op.domain)}else{if(_FileUploaded_Handler){_FileUploaded_Handler(up,file,info)}}};var res=that.parseJSON(info.response);ctx=ctx?ctx:res.ctx;logger.debug("ctx: ",ctx);if(ctx){var key="";logger.debug("save_key: ",op.save_key);if(!op.save_key){key=getFileKey(up,file,that.key_handler);key=key?"/key/"+that.URLSafeBase64Encode(key):""}var fname="/fname/"+that.URLSafeBase64Encode(file.name);logger.debug("op.x_vars: ",op.x_vars);var x_vars=op.x_vars,x_val="",x_vars_url="";if(x_vars!==undefined&&typeof x_vars==="object"){for(var x_key in x_vars){if(x_vars.hasOwnProperty(x_key)){if(typeof x_vars[x_key]==="function"){x_val=that.URLSafeBase64Encode(x_vars[x_key](up,file))}else{if(typeof x_vars[x_key]!=="object"){x_val=that.URLSafeBase64Encode(x_vars[x_key])}}x_vars_url+="/x:"+x_key+"/"+x_val}}}var url=qiniuUploadUrl+"/mkfile/"+file.size+key+fname+x_vars_url;var ie=that.detectIEVersion();var ajax;if(ie&&ie<=9){ajax=new moxie.xhr.XMLHttpRequest();moxie.core.utils.Env.swf_url=op.flash_swf_url}else{ajax=that.createAjax()}ajax.open("POST",url,true);ajax.setRequestHeader("Content-Type","text/plain;charset=UTF-8");console.log("uptoken:"+that.token);ajax.setRequestHeader("Authorization","UpToken "+that.token);var onreadystatechange=function(){logger.debug("ajax.readyState: ",ajax.readyState);if(ajax.readyState===4){localStorage.removeItem(file.name);var ajaxInfo;if(ajax.status===200){ajaxInfo={status:ajax.status,response:ajax.responseText,responseHeaders:ajax.getAllResponseHeaders(),};logger.debug("mkfile is success: ",ajaxInfo);last_step(up,file,ajaxInfo)}else{ajaxInfo={status:ajax.status,response:ajax.responseText,file:file,code:-200,responseHeaders:ajax.getAllResponseHeaders()};logger.debug("mkfile is error: ",ajaxInfo);uploader.trigger("Error",ajaxInfo)}}};if(ie&&ie<=9){ajax.bind("readystatechange",onreadystatechange)}else{ajax.onreadystatechange=onreadystatechange}ajax.send(ctx);logger.debug("mkfile: ",url)}else{last_step(up,file,info)}if(!op.disable_statistics_report){console.log(info.responseHeaders);var req_id=info.responseHeaders.match(/(X-Reqid\:\ )([\w\.\%-]*)/i)[2].replace(/[\r\n]/g,"");var startAt=file._start_at?file._start_at.getTime():nowTime.getTime();statisticsLogger.log(info.status,req_id,getDomainFromUrl(up.settings.url),undefined,getPortFromUrl(up.settings.url),(nowTime.getTime()-startAt)/1000,parseInt(startAt/1000),file.size,"jssdk-"+up.runtime,file.size)}}})(_FileUploaded_Handler));logger.debug("bind FileUploaded event");uploader.bind("FilesRemoved",function(up,files){var nowTime=new Date();if(!op.disable_statistics_report){for(var i=0;i<files.length;i++){statisticsLogger.log(ExtraErrors.Cancelled,undefined,getDomainFromUrl(up.settings.url),undefined,getPortFromUrl(up.settings.url),(nowTime.getTime()-files[i]._start_at.getTime())/1000,files[i]._start_at.getTime()/1000,files[i].size*files[i].percent/100,"jssdk-"+up.runtime,files[i].size)}}});logger.debug("bind FilesRemoved event");uploader.init();logger.debug("invoke uploader.init()");logger.debug("init uploader end");return uploader};this.getUrl=function(key){if(!key){return false}key=encodeURI(key);var domain=this.domain;if(domain.slice(domain.length-1)!=="/"){domain=domain+"/"}return domain+key};this.imageView2=function(op,key){if(!/^\d$/.test(op.mode)){return false}var mode=op.mode,w=op.w||"",h=op.h||"",q=op.q||"",format=op.format||"";if(!w&&!h){return false}var imageUrl="imageView2/"+mode;imageUrl+=w?"/w/"+w:"";imageUrl+=h?"/h/"+h:"";imageUrl+=q?"/q/"+q:"";imageUrl+=format?"/format/"+format:"";if(key){imageUrl=this.getUrl(key)+"?"+imageUrl}return imageUrl};this.imageMogr2=function(op,key){var auto_orient=op["auto-orient"]||"",thumbnail=op.thumbnail||"",strip=op.strip||"",gravity=op.gravity||"",crop=op.crop||"",quality=op.quality||"",rotate=op.rotate||"",format=op.format||"",blur=op.blur||"";var imageUrl="imageMogr2";imageUrl+=auto_orient?"/auto-orient":"";imageUrl+=thumbnail?"/thumbnail/"+thumbnail:"";imageUrl+=strip?"/strip":"";imageUrl+=gravity?"/gravity/"+gravity:"";imageUrl+=quality?"/quality/"+quality:"";imageUrl+=crop?"/crop/"+crop:"";imageUrl+=rotate?"/rotate/"+rotate:"";imageUrl+=format?"/format/"+format:"";imageUrl+=blur?"/blur/"+blur:"";if(key){imageUrl=this.getUrl(key)+"?"+imageUrl}return imageUrl};this.watermark=function(op,key){var mode=op.mode;if(!mode){return false}var imageUrl="watermark/"+mode;if(mode===1){var image=op.image||"";if(!image){return false}imageUrl+=image?"/image/"+this.URLSafeBase64Encode(image):""}else{if(mode===2){var text=op.text?op.text:"",font=op.font?op.font:"",fontsize=op.fontsize?op.fontsize:"",fill=op.fill?op.fill:"";if(!text){return false}imageUrl+=text?"/text/"+this.URLSafeBase64Encode(text):"";imageUrl+=font?"/font/"+this.URLSafeBase64Encode(font):"";imageUrl+=fontsize?"/fontsize/"+fontsize:"";imageUrl+=fill?"/fill/"+this.URLSafeBase64Encode(fill):""}else{return false}}var dissolve=op.dissolve||"",gravity=op.gravity||"",dx=op.dx||"",dy=op.dy||"";imageUrl+=dissolve?"/dissolve/"+dissolve:"";imageUrl+=gravity?"/gravity/"+gravity:"";imageUrl+=dx?"/dx/"+dx:"";imageUrl+=dy?"/dy/"+dy:"";if(key){imageUrl=this.getUrl(key)+"?"+imageUrl}return imageUrl};this.imageInfo=function(key){if(!key){return false}var url=this.getUrl(key)+"?imageInfo";var xhr=this.createAjax();var info;var that=this;xhr.open("GET",url,false);xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){info=that.parseJSON(xhr.responseText)}};xhr.send();return info};this.exif=function(key){if(!key){return false}var url=this.getUrl(key)+"?exif";var xhr=this.createAjax();var info;var that=this;xhr.open("GET",url,false);xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){info=that.parseJSON(xhr.responseText)}};xhr.send();return info};this.get=function(type,key){if(!key||!type){return false}if(type==="exif"){return this.exif(key)}else{if(type==="imageInfo"){return this.imageInfo(key)}}return false};this.pipeline=function(arr,key){var isArray=Object.prototype.toString.call(arr)==="[object Array]";var option,errOp,imageUrl="";if(isArray){for(var i=0,len=arr.length;i<len;i++){option=arr[i];if(!option.fop){return false}switch(option.fop){case"watermark":imageUrl+=this.watermark(option)+"|";break;case"imageView2":imageUrl+=this.imageView2(option)+"|";break;case"imageMogr2":imageUrl+=this.imageMogr2(option)+"|";break;default:errOp=true;break}if(errOp){return false}}if(key){imageUrl=this.getUrl(key)+"?"+imageUrl;var length=imageUrl.length;if(imageUrl.slice(length-1)==="|"){imageUrl=imageUrl.slice(0,length-1)}}return imageUrl}return false}}var Qiniu=new QiniuJsSDK();global.Qiniu=Qiniu;global.QiniuJsSDK=QiniuJsSDK;if(typeof module!=="undefined"&&module.exports){module.exports=QiniuJsSDK}else{if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(0),__webpack_require__(1)],__WEBPACK_AMD_DEFINE_RESULT__=function(){return QiniuJsSDK}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{global.QiniuJsSDK=QiniuJsSDK}}})(window)})]);